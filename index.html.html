            const viewType = document.getElementById('result-view-selector').value;
            
            // Hide all views
            document.getElementById('result-summary').classList.add('hidden');
            document.getElementById('result-detailed').classList.add('hidden');
            document.getElementById('result-visual').classList.add('hidden');
            document.getElementById('result-connections').classList.add('hidden');
            
            // Show selected view
            document.getElementById('result-' + viewType).classList.remove('hidden');
            
            // Initialize view if needed
            if (viewType === 'visual' && threeDScene === null) {
                initialize3DVisualization();
            }
        }
        
        // Switch between connection views
        function switchConnectionView() {
            const viewType = document.getElementById('connection-view').value;
            
            // Update connection drawing and specifications
            updateConnectionDrawing(viewType);
            updateConnectionSpecs(viewType);
        }
        
        // Calculate section moment capacity (AS 4100-2020)
        function calculateMomentCapacity(section, axis, steelGrade) {
            if (!section) return 0;
            
            // Get section modulus
            const Z = axis === 'x' ? section.Zx : section.Zy;
            
            // Get yield stress
            const fy = CONSTANTS.STEEL_GRADE[steelGrade].fy;
            
            // Calculate nominal moment capacity (AS 4100-2020)
            const Ms = Z * fy / 1e6; // Convert to kNm
            
            // Apply capacity factor
            return CONSTANTS.PHI.MOMENT * Ms;
        }
        
        // Calculate section shear capacity (AS 4100-2020)
        function calculateShearCapacity(section, axis, steelGrade) {
            if (!section) return 0;
            
            // Calculate shear area
            let Av;
            
            if (section.hasOwnProperty('tw')) {
                // For I and C sections
                if (axis === 'x') {
                    // Shear in x-direction (parallel to web)
                    Av = section.depth * section.tw;
                } else {
                    // Shear in y-direction (parallel to flanges)
                    Av = 2 * section.width * section.tf;
                }
            } else if (section.hasOwnProperty('thickness')) {
                // For RHS, SHS sections
                if (axis === 'x') {
                    // Major axis shear
                    Av = 2 * section.depth * section.thickness;
                } else {
                    // Minor axis shear
                    Av = 2 * section.width * section.thickness;
                }
            } else if (section.hasOwnProperty('diameter')) {
                // For CHS sections
                Av = 0.6 * Math.PI * section.diameter * section.thickness;
            } else if (section.hasOwnProperty('leg')) {
                // For equal angles
                Av = 2 * 0.6 * section.leg * section.thickness;
            } else if (section.hasOwnProperty('legH')) {
                // For unequal angles
                if (axis === 'x') {
                    Av = 0.6 * section.legH * section.thickness;
                } else {
                    Av = 0.6 * section.legV * section.thickness;
                }
            } else {
                return 0;
            }
            
            // Get yield stress
            const fy = CONSTANTS.STEEL_GRADE[steelGrade].fy;
            
            // Calculate nominal shear capacity (AS 4100-2020)
            const Vw = 0.6 * fy * Av / 1000; // Convert to kN
            
            // Apply capacity factor
            return CONSTANTS.PHI.SHEAR * Vw;
        }
        
        // Calculate member compression capacity (simplified AS 4100-2020)
        function calculateCompressionCapacity(section, steelGrade, effectiveLength) {
            if (!section) return 0;
            
            // Calculate gross area
            let Ag;
            
            if (section.hasOwnProperty('tw')) {
                // For I and C sections
                Ag = 2 * section.width * section.tf + (section.depth - 2 * section.tf) * section.tw;
            } else if (section.hasOwnProperty('thickness')) {
                // For RHS, SHS sections
                if (section.hasOwnProperty('width')) {
                    // RHS or SHS
                    Ag = 2 * (section.depth + section.width - 2 * section.thickness) * section.thickness;
                }
            } else if (section.hasOwnProperty('diameter')) {
                // For CHS sections
                Ag = Math.PI * section.diameter * section.thickness;
            } else if (section.hasOwnProperty('leg')) {
                // For equal angles
                Ag = 2 * section.leg * section.thickness - section.thickness * section.thickness;
            } else if (section.hasOwnProperty('legH')) {
                // For unequal angles
                Ag = (section.legH + section.legV) * section.thickness - section.thickness * section.thickness;
            } else {
                return 0;
            }
            
            // Calculate radius of gyration (x-axis)
            const rx = Math.sqrt(section.Ix / Ag);
            
            // Calculate radius of gyration (y-axis)
            const ry = Math.sqrt(section.Iy / Ag);
            
            // Calculate slenderness ratios
            const slendernessX = effectiveLength / rx;
            const slendernessY = effectiveLength / ry;
            
            // Use the larger slenderness ratio
            const slenderness = Math.max(slendernessX, slendernessY);
            
            // Get yield stress
            const fy = CONSTANTS.STEEL_GRADE[steelGrade].fy;
            
            // Calculate member slenderness parameter
            const lambdaN = slenderness / Math.sqrt(250 / fy);
            
            // Calculate member compression capacity factor alpha_c
            let alphaC;
            
            if (lambdaN <= 1.5) {
                // For λn ≤ 1.5
                alphaC = Math.pow(1 - Math.pow(lambdaN / 1.5, 2), 0.5);
            } else {
                // For λn > 1.5
                alphaC = 0.9 / Math.pow(lambdaN, 2);
            }
            
            // Calculate nominal section compression capacity
            const Ns = fy * Ag / 1000; // Convert to kN
            
            // Calculate nominal member compression capacity
            const Nc = alphaC * Ns;
            
            // Apply capacity factor
            return CONSTANTS.PHI.COMPRESSION * Nc;
        }
        
        // Calculate member deflection
        function calculateDeflection(section, steelGrade, length, load, loadType) {
            if (!section) return 0;
            
            // Get elastic modulus
            const E = CONSTANTS.STEEL_GRADE[steelGrade].E;
            
            // Calculate moment of inertia (mm^4)
            const I = section.Ix;
            
            // Calculate deflection based on load type
            let deflection;
            
            if (loadType === 'uniform') {
                // Uniform load: 5wL^4/(384EI)
                const w = load / (length / 1000); // Convert to kN/m
                deflection = 5 * w * Math.pow(length, 4) / (384 * E * I) * 1e9; // Convert to mm
            } else if (loadType === 'point') {
                // Point load at midspan: PL^3/(48EI)
                deflection = load * Math.pow(length, 3) / (48 * E * I) * 1e9; // Convert to mm
            } else if (loadType === 'triangular') {
                // Triangular load: 0.13wL^4/(EI)
                const w = load / (length / 1000); // Convert to kN/m
                deflection = 0.13 * w * Math.pow(length, 4) / (E * I) * 1e9; // Convert to mm
            } else {
                deflection = 0;
            }
            
            return Math.abs(deflection);
        }
        
        // Design bolted connection
        function designBoltedConnection(section, connectionType, steelGrade, shearForce, connectionData) {
            if (!section) return null;
            
            // Get bolt diameter in mm
            const boltDiameter = parseInt(connectionData.boltDiameter.substring(1));
            
            // Get bolt grade properties
            const boltGradeProps = CONSTANTS.BOLT_GRADE[connectionData.boltGrade];
            
            // Calculate bolt shear capacity
            const boltShearCapacity = CONSTANTS.PHI.BOLT_SHEAR * 0.62 * boltGradeProps.fub * 
                                     Math.PI * Math.pow(boltDiameter/2, 2) / 1000 * connectionData.numBolts;
            
            // Calculate plate dimensions based on connection type
            let plateWidth, plateHeight, plateThickness;
            
            if (connectionType === 'column' || connectionType === 'beam') {
                plateWidth = section.width + 40;
                plateHeight = section.depth + 40;
                plateThickness = Math.max(10, Math.ceil(section.tf * 1.2));
            } else if (connectionType === 'wall') {
                plateWidth = section.width + 40;
                plateHeight = section.depth + 40;
                plateThickness = Math.max(8, Math.ceil(section.tw * 0.9));
            } else if (connectionType === 'foundation') {
                plateWidth = Math.max(section.width + 100, section.width * 1.5);
                plateHeight = Math.max(section.depth + 100, section.depth * 1.5);
                plateThickness = Math.max(16, Math.ceil(section.tf * 1.2));
            } else {
                plateWidth = section.width + 40;
                plateHeight = section.depth + 40;
                plateThickness = 12;
            }
            
            // Calculate plate capacity
            const plateCapacity = CONSTANTS.PHI.BEARING * CONSTANTS.STEEL_GRADE[steelGrade].fy * 
                                 plateThickness * plateWidth / 1000;
            
            // Calculate weld capacity
            const weldLength = 2 * (section.width + section.depth); // Perimeter of section
            const weldCapacity = CONSTANTS.PHI.WELD * 0.6 * CONSTANTS.STEEL_GRADE[steelGrade].fu * 
                                0.7 * connectionData.weldSize * weldLength / 1000;
            
            // Create connection design
            const connection = {
                plateWidth: plateWidth,
                plateHeight: plateHeight,
                plateThickness: plateThickness,
                boltDiameter: connectionData.boltDiameter,
                boltGrade: connectionData.boltGrade,
                numBolts: connectionData.numBolts,
                edgeDistance: connectionData.edgeDistance,
                weldSize: connectionData.weldSize,
                weldType: connectionData.weldType,
                boltShearCapacity: boltShearCapacity,
                plateCapacity: plateCapacity,
                weldCapacity: weldCapacity
            };
            
            // Determine connection capacity (minimum of bolt, plate, and weld capacities)
            connection.shearCapacity = Math.min(boltShearCapacity, plateCapacity, weldCapacity);
            
            // Determine if connection is adequate
            connection.adequate = (shearForce <= connection.shearCapacity);
            
            return connection;
        }
        
        // Generate design results
        function generateResults() {
            if (!sectionData || !loadingData) {
                console.error('Missing section or loading data');
                return;
            }
            
            // Get section information
            const section = sectionData.section;
            const steelGrade = sectionData.steelGrade;
            const memberLength = sectionData.length;
            
            if (!section) {
                showNotification('Section not found', 'error');
                return;
            }
            
            // Calculate total design force
            const totalShearForce = loadingData.deadLoad + loadingData.liveLoad;
            const totalBendingMoment = totalShearForce * memberLength / 4000; // Simple estimate for uniform load
            
            // Calculate member capacities
            const momentCapacity = calculateMomentCapacity(section, 'x', steelGrade);
            const shearCapacity = calculateShearCapacity(section, 'x', steelGrade);
            let compressionCapacity = 0;
            
            if (sectionData.memberType === 'column' || sectionData.memberType === 'brace') {
                compressionCapacity = calculateCompressionCapacity(section, steelGrade, memberLength);
            }
            
            // Calculate deflection
            const deflection = calculateDeflection(
                section, steelGrade, memberLength, totalShearForce, loadingData.loadType || 'uniform'
            );
            
            // Calculate allowable deflection (typically span/300 for serviceability)
            const allowableDeflection = memberLength / 300;
            
            // Calculate utilization ratios
            const momentUtilization = totalBendingMoment / momentCapacity;
            const shearUtilization = totalShearForce / shearCapacity;
            const deflectionUtilization = deflection / allowableDeflection;
            
            // Design connection
            const connection = designBoltedConnection(
                section, connectionData.connectionType, steelGrade, totalShearForce, connectionData
            );
            
            // Update the results table
            updateResultsTables(section, steelGrade, momentCapacity, shearCapacity, compressionCapacity, 
                              totalBendingMoment, totalShearForce, deflection, allowableDeflection,
                              momentUtilization, shearUtilization, deflectionUtilization, connection);
            
            // Generate fabrication instructions
            document.querySelector('.fabrication-instructions pre').textContent = 
                generateFabricationInstructions(section, connection, connectionData);
            
            // Draw shop drawing
            drawShopDrawing(section, connection, connectionData);
            
            // Update detailed analysis
            updateDetailedAnalysis(section, steelGrade, memberLength, loadingData);
            
            // Update connection specs
            updateConnectionSpecs('main');
            
            // Show notification
            showNotification('Design calculation completed successfully', 'success');
        }
        
        // Update results tables
        function updateResultsTables(section, steelGrade, momentCapacity, shearCapacity, compressionCapacity,
                                  totalBendingMoment, totalShearForce, deflection, allowableDeflection,
                                  momentUtilization, shearUtilization, deflectionUtilization, connection) {
            
            // Update member capacities table
            const memberTable = document.querySelector('#result-summary table:first-of-type');
            
            // Update moment capacity row
            memberTable.rows[1].cells[1].textContent = momentCapacity.toFixed(2) + ' kNm';
            memberTable.rows[1].cells[2].textContent = totalBendingMoment.toFixed(2) + ' kNm';
            
            const momentStatus = getStatusClass(momentUtilization);
            memberTable.rows[1].cells[3].innerHTML = 
                `<span class="status ${momentStatus}">${(momentUtilization * 100).toFixed(1)}%</span>`;
            
            // Update shear capacity row
            memberTable.rows[2].cells[1].textContent = shearCapacity.toFixed(2) + ' kN';
            memberTable.rows[2].cells[2].textContent = totalShearForce.toFixed(2) + ' kN';
            
            const shearStatus = getStatusClass(shearUtilization);
            memberTable.rows[2].cells[3].innerHTML = 
                `<span class="status ${shearStatus}">${(shearUtilization * 100).toFixed(1)}%</span>`;
            
            // Update compression capacity row if applicable
            if (compressionCapacity > 0) {
                memberTable.rows[3].cells[1].textContent = compressionCapacity.toFixed(2) + ' kN';
                memberTable.rows[3].cells[2].textContent = 'N/A';
                memberTable.rows[3].cells[3].textContent = 'N/A';
            }
            
            // Update deflection row
            memberTable.rows[4].cells[1].textContent = deflection.toFixed(2) + ' mm';
            memberTable.rows[4].cells[2].textContent = allowableDeflection.toFixed(2) + ' mm';
            
            const deflectionStatus = getStatusClass(deflectionUtilization);
            memberTable.rows[4].cells[3].innerHTML = 
                `<span class="status ${deflectionStatus}">${(deflectionUtilization * 100).toFixed(1)}%</span>`;
            
            // Update section properties table
            const sectionTable = document.querySelector('#result-summary table:nth-of-type(2)');
            
            // Update section information
            sectionTable.rows[1].cells[1].textContent = section.size;
            sectionTable.rows[2].cells[1].textContent = section.mass + ' kg/m';
            sectionTable.rows[3].cells[1].textContent = 'Grade ' + steelGrade;
            
            // Update dimensions
            let dimensionText = '';
            if (section.hasOwnProperty('depth') && section.hasOwnProperty('width')) {
                dimensionText = `${section.depth}×${section.width} mm`;
            } else if (section.hasOwnProperty('width')) {
                dimensionText = `${section.width} mm`;
            } else if (section.hasOwnProperty('diameter')) {
                dimensionText = `${section.diameter} mm diameter`;
            } else if (section.hasOwnProperty('leg')) {
                dimensionText = `${section.leg}×${section.leg} mm`;
            } else if (section.hasOwnProperty('legH')) {
                dimensionText = `${section.legH}×${section.legV} mm`;
            }
            sectionTable.rows[4].cells[1].textContent = dimensionText;
            
            // Update connection design table
            if (connection) {
                const connectionTable = document.querySelector('#result-summary table:nth-of-type(3)');
                
                connectionTable.rows[1].cells[1].textContent = connectionData.connectionType.charAt(0).toUpperCase() + 
                                                              connectionData.connectionType.slice(1);
                connectionTable.rows[2].cells[1].textContent = connectionData.connectionMethod.charAt(0).toUpperCase() + 
                                                              connectionData.connectionMethod.slice(1);
                connectionTable.rows[3].cells[1].textContent = `${connection.numBolts}× ${connection.boltDiameter} Grade ${connection.boltGrade}`;
                connectionTable.rows[4].cells[1].textContent = connection.plateThickness + ' mm';
                connectionTable.rows[5].cells[1].textContent = `${connection.plateWidth}×${connection.plateHeight} mm`;
                connectionTable.rows[6].cells[1].textContent = `${connection.weldSize} mm ${connection.weldType}`;
                connectionTable.rows[7].cells[1].textContent = connection.shearCapacity.toFixed(2) + ' kN';
                
                const connectionStatus = connection.adequate ? 'status-ok' : 'status-error';
                const connectionText = connection.adequate ? 'ADEQUATE' : 'INADEQUATE';
                connectionTable.rows[8].cells[1].innerHTML = `<span class="status ${connectionStatus}">${connectionText}</span>`;
            }
        }
        
        // Update detailed analysis
        function updateDetailedAnalysis(section, steelGrade, memberLength, loadingData) {
            // Get canvas
            const canvas = document.getElementById('detailed-analysis');
            if (!canvas) return;
            
            const ctx = canvas.getContext('2d');
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            
            // Draw member
            const margin = 40;
            const memberY = canvas.height / 3;
            const memberLength_px = canvas.width - 2 * margin;
            const memberDepth_px = 30;
            
            // Draw member outline
            ctx.fillStyle = '#ccc';
            ctx.fillRect(margin, memberY - memberDepth_px/2, memberLength_px, memberDepth_px);
            
            // Draw supports
            drawSupport(ctx, margin, memberY + memberDepth_px/2, 'fixed');
            drawSupport(ctx, margin + memberLength_px, memberY + memberDepth_px/2, 'roller');
            
            // Draw load
            ctx.fillStyle = '#e74c3c';
            ctx.beginPath();
            
            if (loadingData.loadType === 'uniform') {
                // Draw uniform load
                const arrowCount = 10;
                const arrowSpacing = memberLength_px / arrowCount;
                const arrowHeight = 60;
                
                for (let i = 0; i < arrowCount; i++) {
                    const x = margin + i * arrowSpacing + arrowSpacing/2;
                    drawArrow(ctx, x, memberY - memberDepth_px/2 - 10, x, memberY - memberDepth_px/2 - arrowHeight);
                }
                
                // Draw load value
                ctx.fillStyle = '#000';
                ctx.font = '14px Arial';
                ctx.textAlign = 'center';
                ctx.fillText(`${(loadingData.deadLoad + loadingData.liveLoad).toFixed(2)} kN total`, 
                            canvas.width/2, memberY - memberDepth_px/2 - arrowHeight - 10);
                
            } else if (loadingData.loadType === 'point') {
                // Draw point load
                const x = margin + memberLength_px * loadingData.pointPosition;
                const arrowHeight = 60;
                
                drawArrow(ctx, x, memberY - memberDepth_px/2 - 10, x, memberY - memberDepth_px/2 - arrowHeight);
                
                // Draw load value
                ctx.fillStyle = '#000';
                ctx.font = '14px Arial';
                ctx.textAlign = 'center';
                ctx.fillText(`${(loadingData.deadLoad + loadingData.liveLoad).toFixed(2)} kN`, 
                            x, memberY - memberDepth_px/2 - arrowHeight - 10);
            }
            
            // Draw bending moment diagram
            ctx.strokeStyle = '#3498db';
            ctx.lineWidth = 2;
            ctx.beginPath();
            
            const momentY = canvas.height * 2/3;
            const momentScale = 100; // Scale factor for moment diagram
            
            ctx.moveTo(margin, momentY);
            
            if (loadingData.loadType === 'uniform') {
                // Parabolic moment diagram for uniform load
                for (let i = 0; i <= 100; i++) {
                    const x_ratio = i / 100;
                    const x = margin + x_ratio * memberLength_px;
                    
                    // M = wL^2/8 * 4x/L * (1 - x/L) for simply supported beam with UDL
                    const total_load = loadingData.deadLoad + loadingData.liveLoad;
                    const moment = total_load * Math.pow(memberLength/1000, 2)/8 * 4 * x_ratio * (1 - x_ratio);
                    const y = momentY + moment * momentScale;
                    
                    ctx.lineTo(x, y);
                }
            } else if (loadingData.loadType === 'point') {
                // Triangular moment diagram for point load
                const pointPos = loadingData.pointPosition;
                const total_load = loadingData.deadLoad + loadingData.liveLoad;
                const max_moment = total_load * (memberLength/1000) * pointPos * (1 - pointPos);
                
                // Left segment
                for (let i = 0; i <= pointPos * 100; i++) {
                    const x_ratio = i / 100;
                    const x = margin + x_ratio * memberLength_px;
                    
                    // M = Px(1-a/L) for 0 ≤ x ≤ a
                    const moment = total_load * (x_ratio / pointPos) * max_moment;
                    const y = momentY + moment * momentScale;
                    
                    ctx.lineTo(x, y);
                }
                
                // Right segment
                for (let i = Math.ceil(pointPos * 100); i <= 100; i++) {
                    const x_ratio = i / 100;
                    const x = margin + x_ratio * memberLength_px;
                    
                    // M = P(L-x)a/L for a ≤ x ≤ L
                    const moment = total_load * ((1 - x_ratio) / (1 - pointPos)) * max_moment;
                    const y = momentY + moment * momentScale;
                    
                    ctx.lineTo(x, y);
                }
            }
            
            ctx.stroke();
            
            // Draw axes
            ctx.strokeStyle = '#000';
            ctx.lineWidth = 1;
            
            // Moment diagram axis
            ctx.beginPath();
            ctx.moveTo(margin, momentY);
            ctx.lineTo(margin + memberLength_px, momentY);
            ctx.stroke();
            
            // Labels
            ctx.fillStyle = '#000';
            ctx.font = '14px Arial';
            ctx.textAlign = 'right';
            ctx.fillText('Bending Moment (kNm)', margin - 10, momentY);
            
            // Draw maximum moment value
            let maxMoment = 0;
            
            if (loadingData.loadType === 'uniform') {
                // Max moment for uniform load is at midspan, M = wL²/8
                const totalLoad = loadingData.deadLoad + loadingData.liveLoad;
                maxMoment = totalLoad * Math.pow(memberLength/1000, 2) / 8;
            } else if (loadingData.loadType === 'point') {
                // Max moment for point load at position a is M = Pa(1-a/L)
                const totalLoad = loadingData.deadLoad + loadingData.liveLoad;
                const a = loadingData.pointPosition;
                maxMoment = totalLoad * memberLength/1000 * a * (1 - a);
            }
            
            const maxMomentX = margin + memberLength_px/2; // Simplified - assumes max is at midspan
            const maxMomentY = momentY + maxMoment * momentScale;
            
            ctx.fillStyle = '#3498db';
            ctx.beginPath();
            ctx.arc(maxMomentX, maxMomentY, 4, 0, Math.PI * 2);
            ctx.fill();
            
            ctx.fillStyle = '#000';
            ctx.textAlign = 'left';
            ctx.fillText(`Max: ${maxMoment.toFixed(2)} kNm`, maxMomentX + 10, maxMomentY);
            
            // Update analysis notes
            const notesList = document.getElementById('analysis-notes');
            if (notesList) {
                notesList.innerHTML = '';
                
                // Add notes about the analysis
                addAnalysisNote(notesList, `Member: ${section.size} (${section.mass} kg/m), Grade ${steelGrade} steel`);
                addAnalysisNote(notesList, `Span: ${(memberLength/1000).toFixed(2)} m, ${loadingData.loadType} load`);
                addAnalysisNote(notesList, `Maximum moment: ${maxMoment.toFixed(2)} kNm`);
                
                // Calculate maximum deflection
                const E = CONSTANTS.STEEL_GRADE[steelGrade].E;
                const I = section.Ix;
                let maxDeflection = 0;
                
                if (loadingData.loadType === 'uniform') {
                    // Max deflection for uniform load, δ = 5wL⁴/(384EI)
                    const totalLoad = loadingData.deadLoad + loadingData.liveLoad;
                    const w = totalLoad / (memberLength/1000); // kN/m
                    maxDeflection = 5 * w * Math.pow(memberLength, 4) / (384 * E * I) * 1e9; // mm
                } else if (loadingData.loadType === 'point') {
                    // Max deflection for point load at midspan, δ = PL³/(48EI)
                    const totalLoad = loadingData.deadLoad + loadingData.liveLoad;
                    maxDeflection = totalLoad * Math.pow(memberLength, 3) / (48 * E * I) * 1e9; // mm
                }
                
                addAnalysisNote(notesList, `Maximum deflection: ${maxDeflection.toFixed(2)} mm`);
                addAnalysisNote(notesList, `Allowable deflection (L/300): ${(memberLength/300).toFixed(2)} mm`);
                
                // Note about load combination
                addAnalysisNote(notesList, `Load combination: 1.2G + 1.5Q (${loadingData.deadLoad} kN dead load + ${loadingData.liveLoad} kN live load)`);
                
                // Add section capacity notes
                const momentCapacity = calculateMomentCapacity(section, 'x', steelGrade);
                const shearCapacity = calculateShearCapacity(section, 'x', steelGrade);
                
                addAnalysisNote(notesList, `Section moment capacity: ${momentCapacity.toFixed(2)} kNm (${((maxMoment/momentCapacity)*100).toFixed(1)}% utilized)`);
                
                // Calculate maximum shear
                let maxShear = 0;
                if (loadingData.loadType === 'uniform') {
                    // Max shear for uniform load is at supports, V = wL/2
                    const totalLoad = loadingData.deadLoad + loadingData.liveLoad;
                    maxShear = totalLoad;
                } else if (loadingData.loadType === 'point') {
                    // Max shear for point load
                    const totalLoad = loadingData.deadLoad + loadingData.liveLoad;
                    maxShear = totalLoad;
                }
                
                addAnalysisNote(notesList, `Section shear capacity: ${shearCapacity.toFixed(2)} kN (${((maxShear/shearCapacity)*100).toFixed(1)}% utilized)`);
            }
            
            // Update load combinations table
            updateLoadCombinations();
        }
        
        // Add an analysis note
        function addAnalysisNote(notesList, text) {
            const li = document.createElement('li');
            li.textContent = text;
            notesList.appendChild(li);
        }
        
        // Update load combinations table
        function updateLoadCombinations                document.getElementById('point-load-options').classList.toggle('hidden', loadType !== 'point');
            });
            
            // Form validation
            document.querySelectorAll('input[type="number"]').forEach(function(input) {
                input.addEventListener('input', validateInput);
            });
            
            // Loading type radio buttons
            document.querySelectorAll('input[name="loading-type"]').forEach(function(radio) {
                radio.addEventListener('change', function() {
                    toggleLoadingType(this.value);
                });
            });
            
            // Live load type dropdown
            document.getElementById('live-load-type').addEventListener('change', function() {
                document.getElementById('custom-live-load').classList.toggle('hidden', this.value !== 'custom');
            });
            
            // Snow load region dropdown
            document.getElementById('snow-load-region').addEventListener('change', function() {
                document.getElementById('custom-snow-load').classList.toggle('hidden', this.value !== 'custom');
            });
            
            // Load combination standard dropdown
            document.getElementById('load-combination-standard').addEventListener('change', function() {
                document.getElementById('standard-combinations').classList.toggle('hidden', this.value !== 'as1170');
                document.getElementById('custom-combinations').classList.toggle('hidden', this.value !== 'custom');
            });
            
            // Result view selector
            document.getElementById('result-view-selector').addEventListener('change', switchResultView);
        }
        
        // Setup drag and drop functionality
        function setupDragAndDrop() {
            const dropArea = document.getElementById('drop-area');
            
            ['dragenter', 'dragover', 'dragleave', 'drop'].forEach(eventName => {
                dropArea.addEventListener(eventName, preventDefaults, false);
            });
            
            function preventDefaults(e) {
                e.preventDefault();
                e.stopPropagation();
            }
            
            ['dragenter', 'dragover'].forEach(eventName => {
                dropArea.addEventListener(eventName, highlight, false);
            });
            
            ['dragleave', 'drop'].forEach(eventName => {
                dropArea.addEventListener(eventName, unhighlight, false);
            });
            
            function highlight() {
                dropArea.classList.add('drag-over');
            }
            
            function unhighlight() {
                dropArea.classList.remove('drag-over');
            }
            
            dropArea.addEventListener('drop', handleDrop, false);
            
            function handleDrop(e) {
                const dt = e.dataTransfer;
                const files = dt.files;
                
                if (files.length) {
                    handleFileUpload({ target: { files: files } });
                }
            }
        }
        
        // Set up keyboard navigation
        function setupKeyboardNavigation() {
            document.addEventListener('keydown', function(e) {
                // Enter key for selection
                if (e.key === 'Enter') {
                    const focused = document.activeElement;
                    if (focused && focused.classList.contains('choice-card')) {
                        focused.click();
                    }
                }
                
                // Arrow keys for navigation
                if (e.key === 'ArrowRight' && !document.getElementById('next-button').disabled) {
                    nextStep();
                } else if (e.key === 'ArrowLeft' && !document.getElementById('prev-button').disabled) {
                    previousStep();
                }
            });
        }
        
        // Check for saved preferences
        function checkSavedPreferences() {
            // Check if dark mode was previously enabled
            const darkModePref = localStorage.getItem('darkMode');
            if (darkModePref === 'true') {
                toggleDarkMode();
            }
        }
        
        // Toggle dark mode
        function toggleDarkMode() {
            document.body.classList.toggle('dark-mode');
            isDarkMode = document.body.classList.contains('dark-mode');
            
            // Update icon
            const themeToggle = document.querySelector('.theme-toggle');
            themeToggle.innerHTML = isDarkMode ? '☀️' : '🌙';
            
            // Save preference
            localStorage.setItem('darkMode', isDarkMode);
        }
        
        // Select design type
        function selectDesignType(type) {
            designType = type;
            
            // Update UI
            document.getElementById('single-member').classList.remove('selected');
            document.getElementById('frame-design').classList.remove('selected');
            
            document.getElementById(type + '-member').classList.add('selected');
            document.getElementById('next-button').disabled = false;
            
            // Update ARIA attributes
            document.getElementById('single-member').setAttribute('aria-pressed', type === 'single');
            document.getElementById('frame-design').setAttribute('aria-pressed', type === 'frame');
            
            // Show notification
            showNotification(`${type.charAt(0).toUpperCase() + type.slice(1)} member design selected`, 'success');
        }
        
        // Navigate to next step
        function nextStep() {
            // Validate current step data
            if (!validateCurrentStep()) {
                showNotification('Please correct the errors before continuing', 'error');
                return;
            }
            
            // Save data from current step
            saveCurrentStepData();
            
            if (currentStep < 4) {
                currentStep++;
                updateStepDisplay();
                
                // Initialize the new step
                initializeStep(currentStep);
                
                // Scroll to top
                window.scrollTo({ top: 0, behavior: 'smooth' });
            } else {
                // Finish the design
                downloadDesign();
            }
        }
        
        // Navigate to previous step
        function previousStep() {
            if (currentStep > 1) {
                currentStep--;
                updateStepDisplay();
                
                // Scroll to top
                window.scrollTo({ top: 0, behavior: 'smooth' });
            }
        }
        
        // Go to a specific step (for step indicators)
        function goToStep(step) {
            if (step >= 1 && step <= currentStep && step <= 4) {
                currentStep = step;
                updateStepDisplay();
                
                // Scroll to top
                window.scrollTo({ top: 0, behavior: 'smooth' });
            }
        }
        
        // Update step display
        function updateStepDisplay() {
            // Hide all steps
            document.getElementById('step1').classList.add('hidden');
            document.getElementById('step2').classList.add('hidden');
            document.getElementById('step3').classList.add('hidden');
            document.getElementById('step4').classList.add('hidden');
            
            // Show current step
            document.getElementById('step' + currentStep).classList.remove('hidden');
            
            // Update step indicators
            for (let i = 1; i <= 4; i++) {
                const indicator = document.getElementById('step' + i + '-indicator');
                indicator.classList.remove('active', 'completed');
                indicator.setAttribute('aria-selected', i === currentStep);
                indicator.tabIndex = i === currentStep ? 0 : -1;
                
                if (i < currentStep) {
                    indicator.classList.add('completed');
                } else if (i === currentStep) {
                    indicator.classList.add('active');
                }
            }
            
            // Update connecting lines
            for (let i = 1; i < 4; i++) {
                const line = document.getElementById('line' + i + '-' + (i+1));
                if (line) {
                    if (i < currentStep) {
                        line.classList.add('completed');
                    } else {
                        line.classList.remove('completed');
                    }
                }
            }
            
            // Update navigation buttons
            document.getElementById('prev-button').disabled = (currentStep === 1);
            
            const nextButton = document.getElementById('next-button');
            nextButton.textContent = (currentStep === 4) ? 'Download' : 'Next';
            
            if (currentStep === 1) {
                nextButton.disabled = (designType === null);
            } else {
                nextButton.disabled = false;
            }
        }
        
        // Initialize a step
        function initializeStep(step) {
            switch (step) {
                case 2:
                    // Member specifications
                    if (designType === 'single') {
                        document.getElementById('single-member-form').classList.remove('hidden');
                        document.getElementById('frame-design-form').classList.add('hidden');
                    } else {
                        document.getElementById('single-member-form').classList.add('hidden');
                        document.getElementById('frame-design-form').classList.remove('hidden');
                    }
                    break;
                    
                case 3:
                    // Initialize loading forms
                    toggleLoadingType('simple');
                    break;
                    
                case 4:
                    // Generate results
                    generateResults();
                    initializeVisualization();
                    break;
                    
                default:
                    break;
            }
        }
        
        // Validate current step
        function validateCurrentStep() {
            let isValid = true;
            
            switch (currentStep) {
                case 1:
                    // Validate design type selection
                    isValid = designType !== null;
                    break;
                    
                case 2:
                    // Validate member specifications
                    if (designType === 'single') {
                        // Validate member length
                        const memberLength = document.getElementById('member-length').value;
                        if (memberLength < 100) {
                            isValid = false;
                        }
                    } else {
                        // Validate frame dimensions if a frame is uploaded
                        if (uploadedImage) {
                            const frameWidth = document.getElementById('frame-width').value;
                            const frameHeight = document.getElementById('frame-height').value;
                            if (frameWidth < 1000 || frameHeight < 1000) {
                                isValid = false;
                            }
                        } else {
                            isValid = false;
                            showNotification('Please upload a frame sketch', 'error');
                        }
                    }
                    break;
                    
                case 3:
                    // Validate loading information
                    const deadLoad = parseFloat(document.getElementById('dead-load').value);
                    const liveLoad = parseFloat(document.getElementById('live-load').value);
                    
                    if (isNaN(deadLoad) || deadLoad < 0 || isNaN(liveLoad) || liveLoad < 0) {
                        isValid = false;
                    }
                    break;
                    
                default:
                    break;
            }
            
            return isValid;
        }
        
        // Validate individual input
        function validateInput(e) {
            const input = e.target;
            const value = parseFloat(input.value);
            const min = parseFloat(input.min);
            
            if (isNaN(value) || value < min) {
                input.setCustomValidity('Invalid value');
                input.classList.add('invalid');
            } else {
                input.setCustomValidity('');
                input.classList.remove('invalid');
            }
        }
        
        // Save data from the current step
        function saveCurrentStepData() {
            switch (currentStep) {
                case 2:
                    // Member specifications
                    if (designType === 'single') {
                        sectionData = {
                            memberType: document.getElementById('member-type').value,
                            sectionType: document.getElementById('section-type').value,
                            sectionSize: document.getElementById('section-size').value,
                            length: parseFloat(document.getElementById('member-length').value),
                            steelGrade: document.getElementById('steel-grade').value
                        };
                        
                        // Find section in database
                        sectionData.section = findSection(sectionData.sectionType, sectionData.sectionSize);
                        
                        // Get advanced connection data
                        connectionData = {
                            connectionType: document.getElementById('connection-type').value,
                            connectionMethod: document.getElementById('connection-method').value,
                            boltDiameter: document.getElementById('bolt-diameter').value,
                            boltGrade: document.getElementById('bolt-grade').value,
                            numBolts: parseInt(document.getElementById('num-bolts').value),
                            edgeDistance: parseFloat(document.getElementById('edge-distance').value),
                            weldSize: parseFloat(document.getElementById('weld-size').value),
                            weldType: document.getElementById('weld-type').value
                        };
                    } else {
                        // Frame data
                        connectionData = {
                            connectionType: document.getElementById('frame-connection-type').value,
                            connectionMethod: document.getElementById('frame-connection-method').value,
                            frameWidth: parseFloat(document.getElementById('frame-width').value),
                            frameHeight: parseFloat(document.getElementById('frame-height').value)
                        };
                    }
                    break;
                    
                case 3:
                    // Loading conditions
                    const loadingType = document.querySelector('input[name="loading-type"]:checked').value;
                    
                    if (loadingType === 'simple') {
                        loadingData = {
                            deadLoad: parseFloat(document.getElementById('dead-load').value),
                            liveLoad: parseFloat(document.getElementById('live-load').value),
                            windLoad: parseFloat(document.getElementById('wind-load').value),
                            snowLoad: parseFloat(document.getElementById('snow-load').value),
                            loadType: document.getElementById('load-type').value
                        };
                        
                        if (loadingData.loadType === 'point') {
                            loadingData.pointPosition = parseInt(document.getElementById('point-load-position').value) / 100;
                        }
                    } else {
                        // Advanced loading data
                        loadingData = {
                            advanced: true,
                            includeSelfWeight: document.getElementById('include-self-weight').checked,
                            permanentDistributed: parseFloat(document.getElementById('permanent-distributed-load').value),
                            permanentPoint: parseFloat(document.getElementById('permanent-point-load').value),
                            permanentPointPosition: parseFloat(document.getElementById('permanent-point-position').value),
                            liveLoadType: document.getElementById('live-load-type').value,
                            windRegion: document.getElementById('wind-region').value,
                            terrainCategory: document.getElementById('terrain-category').value,
                            buildingImportance: document.getElementById('building-importance').value
                        };
                        
                        // Get selected live load patterns
                        const liveLoadPatterns = [];
                        document.querySelectorAll('#live-load-patterns option:checked').forEach(function(option) {
                            liveLoadPatterns.push(option.value);
                        });
                        loadingData.liveLoadPatterns = liveLoadPatterns;
                        
                        // Get custom load values if specified
                        if (loadingData.liveLoadType === 'custom') {
                            loadingData.customLiveLoad = parseFloat(document.getElementById('custom-live-load-intensity').value);
                            loadingData.customLiveLoadFactor = parseFloat(document.getElementById('custom-live-load-factor').value);
                        }
                        
                        // Snow load
                        loadingData.snowLoadRegion = document.getElementById('snow-load-region').value;
                        if (loadingData.snowLoadRegion === 'custom') {
                            loadingData.customSnowLoad = parseFloat(document.getElementById('custom-snow-load-value').value);
                        }
                        
                        // Load combinations
                        loadingData.loadCombinationStandard = document.getElementById('load-combination-standard').value;
                        loadingData.includeServiceability = document.getElementById('use-serviceability').checked;
                        
                        if (loadingData.loadCombinationStandard === 'custom') {
                            const combinations = [];
                            document.querySelectorAll('.load-combination').forEach(function(combo, index) {
                                combinations.push({
                                    deadFactor: parseFloat(document.getElementById(`combo${index+1}-g-factor`).value),
                                    liveFactor: parseFloat(document.getElementById(`combo${index+1}-q-factor`).value),
                                    windFactor: parseFloat(document.getElementById(`combo${index+1}-w-factor`).value),
                                    snowFactor: parseFloat(document.getElementById(`combo${index+1}-s-factor`).value)
                                });
                            });
                            loadingData.customCombinations = combinations;
                        }
                    }
                    break;
                    
                default:
                    break;
            }
        }
        
        // Show notification
        function showNotification(message, type = 'success') {
            const notification = document.getElementById('notification');
            const messageElement = document.getElementById('notification-message');
            const iconElement = document.getElementById('notification-icon');
            
            // Set message
            messageElement.textContent = message;
            
            // Set icon based on type
            if (type === 'success') {
                iconElement.textContent = '✓';
                notification.className = 'notification notification-success';
            } else if (type === 'error') {
                iconElement.textContent = '✗';
                notification.className = 'notification notification-error';
            } else {
                iconElement.textContent = 'ℹ️';
                notification.className = 'notification';
            }
            
            // Show notification
            notification.classList.add('show');
            
            // Hide after 3 seconds
            setTimeout(hideNotification, 3000);
        }
        
        // Hide notification
        function hideNotification() {
            const notification = document.getElementById('notification');
            notification.classList.remove('show');
        }
        
        // Toggle advanced connection options
        function toggleAdvancedConnections() {
            const advancedOptions = document.getElementById('advanced-connection-options');
            advancedOptions.classList.toggle('hidden');
            
            // Update button text
            const button = document.getElementById('advanced-connection-btn');
            if (advancedOptions.classList.contains('hidden')) {
                button.innerHTML = '<span class="btn-icon">⚙️</span> Advanced Connection Options';
            } else {
                button.innerHTML = '<span class="btn-icon">⚙️</span> Hide Advanced Options';
            }
        }
        
        // Toggle loading type (simple vs advanced)
        function toggleLoadingType(type) {
            document.getElementById('simple-loading-form').classList.toggle('hidden', type !== 'simple');
            document.getElementById('advanced-loading-form').classList.toggle('hidden', type !== 'advanced');
        }
        
        // Add a new load combination
        function addLoadCombination() {
            const container = document.getElementById('load-combinations');
            const index = container.children.length + 1;
            
            const comboDiv = document.createElement('div');
            comboDiv.className = 'load-combination p-4 rounded border bg-light mb-2';
            comboDiv.innerHTML = `
                <div class="flex justify-between mb-2">
                    <h4>Combination ${index}</h4>
                    <button type="button" class="remove-btn" onclick="removeLoadCombination(this)">✕</button>
                </div>
                
                <div class="flex flex-col md:flex-row gap-4">
                    <div class="form-group w-full">
                        <label for="combo${index}-g-factor">Dead Load Factor</label>
                        <input type="number" id="combo${index}-g-factor" value="1.2" step="0.1">
                    </div>
                    
                    <div class="form-group w-full">
                        <label for="combo${index}-q-factor">Live Load Factor</label>
                        <input type="number" id="combo${index}-q-factor" value="1.5" step="0.1">
                    </div>
                    
                    <div class="form-group w-full">
                        <label for="combo${index}-w-factor">Wind Load Factor</label>
                        <input type="number" id="combo${index}-w-factor" value="0" step="0.1">
                    </div>
                    
                    <div class="form-group w-full">
                        <label for="combo${index}-s-factor">Snow Load Factor</label>
                        <input type="number" id="combo${index}-s-factor" value="0" step="0.1">
                    </div>
                </div>
            `;
            
            container.appendChild(comboDiv);
        }
        
        // Remove a load combination
        function removeLoadCombination(button) {
            const combo = button.closest('.load-combination');
            combo.parentNode.removeChild(combo);
            
            // Renumber remaining combinations
            const combinations = document.querySelectorAll('.load-combination');
            combinations.forEach(function(combo, index) {
                const title = combo.querySelector('h4');
                title.textContent = `Combination ${index + 1}`;
                
                // Update input IDs
                const inputs = combo.querySelectorAll('input');
                inputs.forEach(function(input) {
                    const newId = input.id.replace(/combo\d+/, `combo${index + 1}`);
                    const label = combo.querySelector(`label[for="${input.id}"]`);
                    
                    input.id = newId;
                    label.setAttribute('for', newId);
                });
            });
        }
        
        // Update point load position display
        function updatePointLoadDisplay() {
            const position = document.getElementById('point-load-position').value;
            document.getElementById('point-load-display').textContent = `Position: ${position}% of span`;
        }
        
        // Update section sizes dropdown
        function updateSectionSizes() {
            const sectionTypeSelect = document.getElementById('section-type');
            const sectionSizeSelect = document.getElementById('section-size');
            
            if (!sectionTypeSelect || !sectionSizeSelect) return;
            
            const sectionType = sectionTypeSelect.value;
            
            // Clear existing options
            sectionSizeSelect.innerHTML = '';
            
            // Add new options
            if (sectionDatabase[sectionType]) {
                sectionDatabase[sectionType].forEach(section => {
                    const option = document.createElement('option');
                    option.value = section.size;
                    option.textContent = `${section.size} (${section.mass} kg/m)`;
                    sectionSizeSelect.appendChild(option);
                });
                
                // Update section details
                updateSectionDetails();
            }
        }
        
        // Update section details display
        function updateSectionDetails() {
            const sectionTypeSelect = document.getElementById('section-type');
            const sectionSizeSelect = document.getElementById('section-size');
            const detailsDiv = document.getElementById('section-details');
            
            if (!sectionTypeSelect || !sectionSizeSelect || !detailsDiv) return;
            
            const sectionType = sectionTypeSelect.value;
            const sectionSize = sectionSizeSelect.value;
            
            // Find section in database
            const section = findSection(sectionType, sectionSize);
            
            if (section) {
                // Create HTML for section details
                let html = '';
                
                // Always show weight
                html += `<div class="section-property">Weight: ${section.mass} kg/m</div>`;
                
                // Show dimensions based on section type
                if (section.hasOwnProperty('depth')) {
                    html += `<div class="section-property">Depth: ${section.depth} mm</div>`;
                }
                
                if (section.hasOwnProperty('width')) {
                    html += `<div class="section-property">Width: ${section.width} mm</div>`;
                }
                
                if (section.hasOwnProperty('diameter')) {
                    html += `<div class="section-property">Diameter: ${section.diameter} mm</div>`;
                }
                
                if (section.hasOwnProperty('leg')) {
                    html += `<div class="section-property">Leg: ${section.leg} mm</div>`;
                }
                
                if (section.hasOwnProperty('legH') && section.hasOwnProperty('legV')) {
                    html += `<div class="section-property">Legs: ${section.legH}×${section.legV} mm</div>`;
                }
                
                if (section.hasOwnProperty('tf')) {
                    html += `<div class="section-property">Flange: ${section.tf} mm</div>`;
                }
                
                if (section.hasOwnProperty('tw')) {
                    html += `<div class="section-property">Web: ${section.tw} mm</div>`;
                }
                
                if (section.hasOwnProperty('thickness')) {
                    html += `<div class="section-property">Thickness: ${section.thickness} mm</div>`;
                }
                
                // Add section properties for advanced users
                html += `<div class="section-property">Ix: ${formatNumber(section.Ix)} mm⁴</div>`;
                html += `<div class="section-property">Zx: ${formatNumber(section.Zx)} mm³</div>`;
                
                detailsDiv.innerHTML = html;
            }
        }
        
        // Format large numbers with SI prefixes
        function formatNumber(value) {
            if (value >= 1e9) {
                return (value / 1e9).toFixed(2) + ' G';
            } else if (value >= 1e6) {
                return (value / 1e6).toFixed(2) + ' M';
            } else if (value >= 1e3) {
                return (value / 1e3).toFixed(2) + ' k';
            } else {
                return value.toFixed(2);
            }
        }
        
        // Handle file upload
        function handleFileUpload(event) {
            const file = event.target.files[0];
            
            if (file) {
                const reader = new FileReader();
                
                reader.onload = function(e) {
                    uploadedImage = e.target.result;
                    
                    const previewImage = document.getElementById('preview-image');
                    const previewContainer = document.getElementById('preview-container');
                    
                    if (previewImage && previewContainer) {
                        previewImage.src = uploadedImage;
                        previewContainer.classList.remove('hidden');
                        
                        // Show notification
                        showNotification('File uploaded successfully', 'success');
                    }
                };
                
                reader.onerror = function() {
                    showNotification('Error reading file', 'error');
                };
                
                reader.readAsDataURL(file);
            }
        }
        
        // Update connection options based on connection type
        function updateConnectionOptions() {
            const connectionTypeSelect = document.getElementById('connection-type');
            const optionsDiv = document.getElementById('connection-options');
            
            if (!connectionTypeSelect || !optionsDiv) return;
            
            const connectionType = connectionTypeSelect.value;
            
            // Clear existing options
            optionsDiv.innerHTML = '';
            
            // Add different options based on connection type
            if (connectionType === 'column' || connectionType === 'beam') {
                let html = '<div class="form-group">';
                html += `<label for="support-section">Support Section:</label>`;
                html += '<select id="support-section">';
                
                // Add appropriate section options
                const sectionType = connectionType === 'column' ? 'uc' : 'ub';
                
                if (sectionDatabase[sectionType]) {
                    sectionDatabase[sectionType].forEach(section => {
                        html += `<option value="${section.size}">${section.size}</option>`;
                    });
                }
                
                html += '</select>';
                html += '</div>';
                
                // Add orientation option
                html += '<div class="form-group mt-4">';
                html += '<label for="connection-orientation">Connection Orientation:</label>';
                html += '<select id="connection-orientation">';
                html += '<option value="flush">Flush/Centered</option>';
                html += '<option value="offset">Offset</option>';
                html += '</select>';
                html += '</div>';
                
                // Add offset input if needed
                html += '<div id="offset-options" class="hidden">';
                html += '<div class="form-group">';
                html += '<label for="connection-offset">Offset Distance (mm):</label>';
                html += '<input type="number" id="connection-offset" value="0">';
                html += '</div>';
                html += '</div>';
                
                optionsDiv.innerHTML = html;
                
                // Add event listener for orientation change
                document.getElementById('connection-orientation').addEventListener('change', function() {
                    document.getElementById('offset-options').classList.toggle('hidden', this.value !== 'offset');
                });
            } else if (connectionType === 'wall') {
                let html = '<div class="form-group">';
                html += '<label for="wall-material">Wall Material:</label>';
                html += '<select id="wall-material">';
                html += '<option value="concrete">Concrete</option>';
                html += '<option value="masonry">Masonry</option>';
                html += '<option value="timber">Timber</option>';
                html += '</select>';
                html += '</div>';
                
                html += '<div class="form-group mt-4">';
                html += '<label for="anchor-type">Anchor Type:</label>';
                html += '<select id="anchor-type">';
                html += '<option value="expansion">Expansion Anchor</option>';
                html += '<option value="chemical">Chemical Anchor</option>';
                html += '<option value="throughbolt">Through Bolt</option>';
                html += '</select>';
                html += '</div>';
                
                optionsDiv.innerHTML = html;
            } else if (connectionType === 'foundation') {
                let html = '<div class="form-group">';
                html += '<label for="foundation-type">Foundation Type:</label>';
                html += '<select id="foundation-type">';
                html += '<option value="pad">Pad Foundation</option>';
                html += '<option value="strip">Strip Foundation</option>';
                html += '<option value="raft">Raft Foundation</option>';
                html += '</select>';
                html += '</div>';
                
                html += '<div class="form-group mt-4">';
                html += '<label for="concrete-grade">Concrete Grade:</label>';
                html += '<select id="concrete-grade">';
                html += '<option value="25">25 MPa</option>';
                html += '<option value="32">32 MPa</option>';
                html += '<option value="40">40 MPa</option>';
                html += '</select>';
                html += '</div>';
                
                html += '<div class="form-group mt-4">';
                html += '<label for="anchor-type">Anchor Type:</label>';
                html += '<select id="anchor-type">';
                html += '<option value="cast-in">Cast-in Anchor Bolts</option>';
                html += '<option value="post-installed">Post-Installed Anchors</option>';
                html += '</select>';
                html += '</div>';
                
                optionsDiv.innerHTML = html;
            }
        }
        
        // Find a section in the database
        function findSection(type, size) {
            if (!sectionDatabase[type]) return null;
            
            return sectionDatabase[type].find(section => section.size === size);
        }
        
        // Switch between different result views
        function switchResultView() {
            const viewType<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Australian Steel Design Assistant</title>
    <style>
        /* Reset and base styles */
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }
        
        :root {
            --primary-color: #3498db;
            --primary-dark: #2980b9;
            --secondary-color: #95a5a6;
            --secondary-dark: #7f8c8d;
            --success-color: #2ecc71;
            --warning-color: #f39c12;
            --danger-color: #e74c3c;
            --light-bg: #f5f7fa;
            --card-bg: #ffffff;
            --text-color: #2c3e50;
            --text-light: #7f8c8d;
            --border-color: #e0e0e0;
            --border-radius: 10px;
            --shadow: 0 2px 10px rgba(0,0,0,0.1);
            --transition: all 0.3s ease;
            --padding-base: 20px;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background-color: var(--light-bg);
            color: var(--text-color);
            line-height: 1.6;
            padding: var(--padding-base);
            min-height: 100vh;
        }
        
        /* App container */
        .app-container {
            max-width: 1200px;
            margin: 0 auto;
        }
        
        /* Header styling */
        .header {
            text-align: center;
            background: linear-gradient(135deg, #2c3e50, #3498db);
            color: white;
            padding: 25px;
            border-radius: var(--border-radius);
            margin-bottom: 30px;
            box-shadow: var(--shadow);
            position: relative;
            overflow: hidden;
        }
        
        .header::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="100" height="100" viewBox="0 0 100 100"><rect x="10" y="30" width="80" height="5" fill="rgba(255,255,255,0.1)"/><rect x="20" y="45" width="60" height="5" fill="rgba(255,255,255,0.1)"/><rect x="30" y="60" width="40" height="5" fill="rgba(255,255,255,0.1)"/></svg>');
            opacity: 0.1;
        }
        
        .header h1 {
            font-size: clamp(1.8em, 5vw, 2.5em);
            margin-bottom: 10px;
            position: relative;
        }
        
        .header p {
            font-size: clamp(1em, 3vw, 1.2em);
            opacity: 0.9;
            position: relative;
        }
        
        /* Card styling */
        .card {
            background: var(--card-bg);
            border-radius: var(--border-radius);
            box-shadow: var(--shadow);
            padding: 30px;
            margin-bottom: 20px;
            transition: var(--transition);
        }
        
        .card:focus-within {
            box-shadow: 0 0 0 3px rgba(52, 152, 219, 0.3), var(--shadow);
        }
        
        /* Step indicators */
        .steps {
            display: flex;
            justify-content: center;
            flex-wrap: wrap;
            margin-bottom: 30px;
            gap: 5px;
        }
        
        .step {
            display: flex;
            align-items: center;
        }
        
        .step-circle {
            width: 36px;
            height: 36px;
            border-radius: 50%;
            background-color: var(--border-color);
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            position: relative;
            z-index: 1;
            transition: var(--transition);
        }
        
        .step-circle.active {
            background-color: var(--primary-color);
            box-shadow: 0 0 0 4px rgba(52, 152, 219, 0.2);
        }
        
        .step-circle.completed {
            background-color: var(--success-color);
        }
        
        .step-line {
            height: 4px;
            width: clamp(30px, 5vw, 60px);
            background-color: var(--border-color);
            margin: 0 5px;
            transition: var(--transition);
        }
        
        .step-line.completed {
            background-color: var(--success-color);
        }
        
        .step-label {
            display: none;
            margin-top: 8px;
            text-align: center;
            font-size: 0.85em;
            color: var(--text-light);
        }
        
        @media (min-width: 768px) {
            .step-label {
                display: block;
            }
            
            .steps {
                display: flex;
                align-items: flex-start;
            }
            
            .step {
                flex-direction: column;
                align-items: center;
            }
            
            .step-line {
                width: 60px;
                height: 4px;
                margin: 16px 0 0 0;
            }
        }
        
        /* Choice cards */
        .choice-container {
            display: flex;
            flex-direction: column;
            gap: 20px;
            margin: 30px 0;
        }
        
        @media (min-width: 768px) {
            .choice-container {
                flex-direction: row;
                justify-content: center;
                gap: 40px;
            }
        }
        
        .choice-card {
            flex: 1;
            min-width: 0; /* Prevents overflow */
            background: var(--card-bg);
            border: 2px solid var(--border-color);
            border-radius: var(--border-radius);
            padding: 25px;
            text-align: center;
            cursor: pointer;
            transition: var(--transition);
            position: relative;
            overflow: hidden;
        }
        
        .choice-card:focus-within {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(52, 152, 219, 0.3);
        }
        
        .choice-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 20px rgba(0,0,0,0.1);
        }
        
        .choice-card.selected {
            border-color: var(--primary-color);
            background-color: #f0f9ff;
        }
        
        .choice-card.selected::before {
            content: "✓";
            position: absolute;
            top: 10px;
            right: 10px;
            width: 24px;
            height: 24px;
            background: var(--success-color);
            color: white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 14px;
            font-weight: bold;
        }
        
        .choice-card .icon {
            font-size: 48px;
            margin-bottom: 15px;
            color: var(--primary-color);
            transition: var(--transition);
        }
        
        .choice-card:hover .icon {
            transform: scale(1.1);
        }
        
        .choice-card h3 {
            margin-bottom: 10px;
        }
        
        .choice-card p {
            font-size: 0.95em;
            color: var(--text-light);
        }
        
        /* Form styling */
        .form-group {
            margin-bottom: 20px;
            position: relative;
        }
        
        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: var(--text-color);
        }
        
        input, select {
            width: 100%;
            padding: 12px;
            border: 1px solid var(--border-color);
            border-radius: 8px;
            font-size: 16px;
            transition: var(--transition);
            background-color: var(--card-bg);
        }
        
        input:hover, select:hover {
            border-color: #bdc3c7;
        }
        
        input:focus, select:focus {
            border-color: var(--primary-color);
            outline: none;
            box-shadow: 0 0 0 3px rgba(52, 152, 219, 0.2);
        }
        
        input:invalid, select:invalid {
            border-color: var(--danger-color);
            box-shadow: none;
        }
        
        .input-hint {
            color: var(--text-light);
            font-size: 0.85em;
            margin-top: 4px;
        }
        
        .input-error {
            color: var(--danger-color);
            font-size: 0.85em;
            margin-top: 4px;
            display: none;
        }
        
        input:invalid + .input-error {
            display: block;
        }
        
        /* Button styling */
        .button-container {
            display: flex;
            justify-content: space-between;
            margin-top: 30px;
            flex-wrap: wrap;
            gap: 10px;
        }
        
        .btn {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            background-color: var(--primary-color);
            color: white;
            border: none;
            padding: 12px 25px;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition);
            text-align: center;
            min-width: 120px;
        }
        
        .btn:hover {
            background-color: var(--primary-dark);
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }
        
        .btn:active {
            transform: translateY(0);
            box-shadow: none;
        }
        
        .btn:focus {
            outline: none;
            box-shadow: 0 0 0 3px rgba(52, 152, 219, 0.3);
        }
        
        .btn-secondary {
            background-color: var(--secondary-color);
        }
        
        .btn-secondary:hover {
            background-color: var(--secondary-dark);
        }
        
        .btn-success {
            background-color: var(--success-color);
        }
        
        .btn-success:hover {
            background-color: #27ae60;
        }
        
        .btn-icon {
            margin-right: 8px;
            font-size: 1.2em;
        }
        
        .btn:disabled {
            background-color: #bdc3c7;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
            opacity: 0.7;
        }
        
        /* Utility classes */
        .hidden {
            display: none !important;
        }
        
        .flex {
            display: flex;
        }
        
        .flex-col {
            flex-direction: column;
        }
        
        .gap-2 {
            gap: 8px;
        }
        
        .gap-4 {
            gap: 16px;
        }
        
        .items-center {
            align-items: center;
        }
        
        .justify-between {
            justify-content: space-between;
        }
        
        .flex-wrap {
            flex-wrap: wrap;
        }
        
        .w-full {
            width: 100%;
        }
        
        .mb-2 {
            margin-bottom: 8px;
        }
        
        .mb-4 {
            margin-bottom: 16px;
        }
        
        .mt-4 {
            margin-top: 16px;
        }
        
        .p-4 {
            padding: 16px;
        }
        
        .bg-light {
            background-color: var(--light-bg);
        }
        
        .rounded {
            border-radius: var(--border-radius);
        }
        
        .border {
            border: 1px solid var(--border-color);
        }
        
        /* File upload */
        .file-upload {
            border: 2px dashed var(--border-color);
            border-radius: var(--border-radius);
            padding: 40px;
            text-align: center;
            margin-bottom: 20px;
            transition: var(--transition);
            cursor: pointer;
            position: relative;
        }
        
        .file-upload:hover, .file-upload.drag-over {
            border-color: var(--primary-color);
            background-color: #f8f9fa;
        }
        
        .file-upload input[type="file"] {
            display: none;
        }
        
        .upload-icon {
            font-size: 48px;
            color: var(--primary-color);
            margin-bottom: 15px;
            transition: var(--transition);
        }
        
        .file-upload:hover .upload-icon {
            transform: scale(1.1);
        }
        
        /* Loading spinner */
        .spinner {
            display: inline-block;
            width: 24px;
            height: 24px;
            border: 3px solid rgba(255,255,255,0.3);
            border-radius: 50%;
            border-top-color: white;
            animation: spin 1s ease-in-out infinite;
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        
        /* Connection options */
        .connection-box {
            background-color: #f8f9fa;
            border: 1px solid var(--border-color);
            border-radius: var(--border-radius);
            padding: 20px;
            margin-top: 20px;
            transition: var(--transition);
        }
        
        .connection-box:hover {
            box-shadow: 0 5px 15px rgba(0,0,0,0.05);
        }
        
        .connection-box h3 {
            margin-top: 0;
            margin-bottom: 15px;
            color: var(--text-color);
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .connection-box h3::before {
            content: "🔗";
            font-size: 1.2em;
        }
        
        /* Section details */
        .section-details {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-top: 10px;
        }
        
        .section-property {
            background-color: #e8f4fc;
            padding: 8px 12px;
            border-radius: 6px;
            font-size: 14px;
            transition: var(--transition);
            display: flex;
            align-items: center;
            gap: 5px;
        }
        
        .section-property:hover {
            background-color: #d1ebfc;
            transform: translateY(-2px);
        }
        
        .section-property::before {
            content: "•";
            color: var(--primary-color);
            font-weight: bold;
        }
        
        /* Tooltips */
        .tooltip {
            position: relative;
            display: inline-block;
            cursor: help;
        }
        
        .tooltip::after {
            content: attr(data-tooltip);
            position: absolute;
            bottom: 125%;
            left: 50%;
            transform: translateX(-50%);
            background-color: #333;
            color: white;
            padding: 8px 12px;
            border-radius: 4px;
            font-size: 12px;
            white-space: nowrap;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
            pointer-events: none;
            z-index: 10;
        }
        
        .tooltip::before {
            content: "";
            position: absolute;
            bottom: 75%;
            left: 50%;
            transform: translateX(-50%);
            border: 6px solid transparent;
            border-top-color: #333;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
            pointer-events: none;
            z-index: 10;
        }
        
        .tooltip:hover::after,
        .tooltip:hover::before,
        .tooltip:focus::after,
        .tooltip:focus::before {
            opacity: 1;
            visibility: visible;
        }
        
        /* Results styling */
        .results-container {
            display: grid;
            grid-template-columns: 1fr;
            gap: 20px;
        }
        
        @media (min-width: 992px) {
            .results-container {
                grid-template-columns: 1fr 1fr;
            }
        }
        
        .result-section {
            background-color: #f8f9fa;
            border: 1px solid var(--border-color);
            border-radius: var(--border-radius);
            padding: 20px;
            transition: var(--transition);
        }
        
        .result-section:hover {
            box-shadow: 0 5px 15px rgba(0,0,0,0.05);
        }
        
        .result-section h3 {
            margin-top: 0;
            margin-bottom: 15px;
            color: var(--text-color);
            border-bottom: 1px solid var(--border-color);
            padding-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .result-section h3::before {
            content: "";
            width: 16px;
            height: 16px;
            background-color: var(--primary-color);
            border-radius: 50%;
        }
        
        .result-table {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: 20px;
        }
        
        .result-table th, .result-table td {
            padding: 10px;
            border: 1px solid var(--border-color);
            text-align: left;
        }
        
        .result-table th {
            background-color: #f0f9ff;
            font-weight: 600;
        }
        
        .result-table tr:nth-child(even) {
            background-color: rgba(0,0,0,0.02);
        }
        
        .result-table tr:hover {
            background-color: rgba(52, 152, 219, 0.05);
        }
        
        .drawing-container {
            border: 1px solid var(--border-color);
            border-radius: var(--border-radius);
            overflow: hidden;
            margin: 20px 0;
            background-color: white;
        }
        
        canvas {
            display: block;
            width: 100%;
            background-color: white;
        }
        
        .fabrication-instructions {
            background-color: #f8f9fa;
            border: 1px solid var(--border-color);
            border-radius: var(--border-radius);
            padding: 15px;
            margin-top: 20px;
            font-family: monospace;
            white-space: pre-wrap;
            max-height: 300px;
            overflow-y: auto;
        }
        
        /* Status indicators */
        .status {
            display: inline-flex;
            align-items: center;
            padding: 4px 8px;
            border-radius: 4px;
            font-weight: 600;
            font-size: 12px;
            gap: 4px;
        }
        
        .status-ok {
            background-color: #d4f7e7;
            color: #1e8b5a;
        }
        
        .status-ok::before {
            content: "✓";
        }
        
        .status-warning {
            background-color: #fff4de;
            color: #946e23;
        }
        
        .status-warning::before {
            content: "⚠";
        }
        
        .status-error {
            background-color: #ffe5e5;
            color: #b73939;
        }
        
        .status-error::before {
            content: "✗";
        }
        
        /* Notifications */
        .notification {
            position: fixed;
            bottom: 20px;
            right: 20px;
            padding: 15px 20px;
            background: white;
            border-radius: var(--border-radius);
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            display: flex;
            align-items: center;
            gap: 10px;
            transform: translateY(100px);
            opacity: 0;
            z-index: 1000;
            transition: all 0.3s cubic-bezier(0.68, -0.55, 0.27, 1.55);
        }
        
        .notification.show {
            transform: translateY(0);
            opacity: 1;
        }
        
        .notification-success {
            border-left: 4px solid var(--success-color);
        }
        
        .notification-error {
            border-left: 4px solid var(--danger-color);
        }
        
        .notification-icon {
            font-size: 1.5em;
        }
        
        .notification-close {
            margin-left: auto;
            background: none;
            border: none;
            cursor: pointer;
            font-size: 1.2em;
            opacity: 0.5;
            transition: var(--transition);
        }
        
        .notification-close:hover {
            opacity: 1;
        }
        
        /* Theme toggle */
        .theme-toggle {
            position: absolute;
            top: 10px;
            right: 10px;
            background: rgba(255,255,255,0.2);
            border: none;
            border-radius: 50%;
            width: 32px;
            height: 32px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            color: white;
            font-size: 18px;
            transition: var(--transition);
        }
        
        .theme-toggle:hover {
            background: rgba(255,255,255,0.3);
            transform: rotate(30deg);
        }
        
        /* Dark mode */
        .dark-mode {
            --light-bg: #1a1c20;
            --card-bg: #2d3035;
            --text-color: #e5e5e5;
            --text-light: #a0a0a0;
            --border-color: #3a3d42;
            --shadow: 0 2px 10px rgba(0,0,0,0.2);
            color-scheme: dark;
        }
        
        .dark-mode .header {
            background: linear-gradient(135deg, #1a1c20, #2980b9);
        }
        
        .dark-mode .status-ok {
            background-color: rgba(46, 204, 113, 0.2);
            color: #72e09f;
        }
        
        .dark-mode .status-warning {
            background-color: rgba(243, 156, 18, 0.2);
            color: #f5be61;
        }
        
        .dark-mode .status-error {
            background-color: rgba(231, 76, 60, 0.2);
            color: #f5938a;
        }
        
        .dark-mode input, .dark-mode select {
            background-color: #3a3d42;
            color: #e5e5e5;
            border-color: #4a4d52;
        }
        
        .dark-mode .section-property {
            background-color: rgba(52, 152, 219, 0.1);
        }
        
        .dark-mode .connection-box,
        .dark-mode .result-section,
        .dark-mode .fabrication-instructions {
            background-color: rgba(255, 255, 255, 0.03);
        }
        
        .dark-mode .result-table th {
            background-color: rgba(52, 152, 219, 0.1);
        }
        
        .dark-mode .result-table tr:nth-child(even) {
            background-color: rgba(255, 255, 255, 0.01);
        }
        
        .dark-mode .result-table tr:hover {
            background-color: rgba(52, 152, 219, 0.05);
        }
        
        .dark-mode .notification {
            background: #2d3035;
            color: #e5e5e5;
        }
        
        /* Animations */
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        
        @keyframes slideIn {
            from { transform: translateY(20px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }
        
        .card {
            animation: fadeIn 0.5s ease-out;
        }
        
        .fade-in {
            animation: fadeIn 0.5s ease-out;
        }
        
        .slide-in {
            animation: slideIn 0.5s ease-out;
        }
    </style>
</head>
<body>
    <div class="app-container">
        <div class="header">
            <button class="theme-toggle" aria-label="Toggle dark mode" onclick="toggleDarkMode()">🌙</button>
            <h1>Australian Steel Design Assistant</h1>
            <p>Compliant with AS 4100-2020</p>
        </div>
        
        <!-- Step indicators -->
        <div class="steps" role="tablist" aria-label="Design Process Steps">
            <div class="step">
                <div class="step-circle active" id="step1-indicator" role="tab" aria-selected="true" aria-controls="step1" tabindex="0">1</div>
                <div class="step-label">Design Type</div>
            </div>
            <div class="step-line" id="line1-2"></div>
            <div class="step">
                <div class="step-circle" id="step2-indicator" role="tab" aria-selected="false" aria-controls="step2" tabindex="-1">2</div>
                <div class="step-label">Specifications</div>
            </div>
            <div class="step-line" id="line2-3"></div>
            <div class="step">
                <div class="step-circle" id="step3-indicator" role="tab" aria-selected="false" aria-controls="step3" tabindex="-1">3</div>
                <div class="step-label">Loading</div>
            </div>
            <div class="step-line" id="line3-4"></div>
            <div class="step">
                <div class="step-circle" id="step4-indicator" role="tab" aria-selected="false" aria-controls="step4" tabindex="-1">4</div>
                <div class="step-label">Results</div>
            </div>
        </div>
        
        <!-- Step 1: Design Type Selection -->
        <div class="card" id="step1" role="tabpanel" aria-labelledby="step1-indicator">
            <h2>Choose Design Type</h2>
            <div class="choice-container">
                <div class="choice-card" id="single-member" onclick="selectDesignType('single')" role="button" tabindex="0" aria-pressed="false">
                    <div class="icon">📏</div>
                    <h3>Single Member</h3>
                    <p>Design a single structural steel member such as a beam or column</p>
                    <div class="tooltip" data-tooltip="Select for individual element design">ℹ️</div>
                </div>
                <div class="choice-card" id="frame-design" onclick="selectDesignType('frame')" role="button" tabindex="0" aria-pressed="false">
                    <div class="icon">🏗️</div>
                    <h3>Frame Design</h3>
                    <p>Upload a sketch and design multiple members working together as a frame</p>
                    <div class="tooltip" data-tooltip="Select for multi-member structures">ℹ️</div>
                </div>
            </div>
        </div>
        
        <!-- Step 2: Member Specifications -->
        <div class="card hidden" id="step2" role="tabpanel" aria-labelledby="step2-indicator">
            <!-- Single Member Form -->
            <div id="single-member-form" class="hidden">
                <h2>Member Specifications</h2>
                <div class="flex flex-col md:flex-row gap-4 mb-4">
                    <div class="form-group w-full">
                        <label for="member-type">
                            Member Type
                            <span class="tooltip" data-tooltip="Select the structural role of this member">ℹ️</span>
                        </label>
                        <select id="member-type" aria-describedby="member-type-hint">
                            <option value="beam">Beam</option>
                            <option value="column">Column</option>
                            <option value="brace">Brace</option>
                            <option value="purlin">Purlin</option>
                            <option value="girt">Girt</option>
                        </select>
                        <div id="member-type-hint" class="input-hint">The structural role determines the loading conditions</div>
                    </div>
                    
                    <div class="form-group w-full">
                        <label for="section-type">
                            Section Type
                            <span class="tooltip" data-tooltip="The cross-section profile of the steel member">ℹ️</span>
                        </label>
                        <select id="section-type" onchange="updateSectionSizes()" aria-describedby="section-type-hint">
                            <option value="ub">Universal Beam (UB)</option>
                            <option value="uc">Universal Column (UC)</option>
                            <option value="pfc">Parallel Flange Channel (PFC)</option>
                            <option value="rhs">Rectangular Hollow Section (RHS)</option>
                            <option value="shs">Square Hollow Section (SHS)</option>
                            <option value="angle">Equal Angle (EA)</option>
                            <option value="uangle">Unequal Angle (UA)</option>
                            <option value="chs">Circular Hollow Section (CHS)</option>
                        </select>
                        <div id="section-type-hint" class="input-hint">Different sections have different structural properties</div>
                    </div>
                </div>
                
                <div class="form-group">
                    <label for="section-size">Section Size</label>
                    <select id="section-size" onchange="updateSectionDetails()"></select>
                    <div id="section-details" class="section-details mt-4"></div>
                </div>
                
                <div class="flex flex-col md:flex-row gap-4">
                    <div class="form-group w-full">
                        <label for="member-length">
                            Length (mm)
                            <span class="tooltip" data-tooltip="The total length of the member from support to support">ℹ️</span>
                        </label>
                        <input type="number" id="member-length" value="3000" min="100" required aria-describedby="length-hint">
                        <div id="length-hint" class="input-hint">Typical range: 1000-10000mm</div>
                        <div class="input-error">Please enter a valid length (minimum 100mm)</div>
                    </div>
                    
                    <div class="form-group w-full">
                        <label for="steel-grade">
                            Steel Grade
                            <span class="tooltip" data-tooltip="The strength grade of steel according to AS/NZS standards">ℹ️</span>
                        </label>
                        <select id="steel-grade" aria-describedby="grade-hint">
                            <option value="300">Grade 300</option>
                            <option value="350">Grade 350</option>
                            <option value="400">Grade 400</option>
                            <option value="450">Grade 450</option>
                        </select>
                        <div id="grade-hint" class="input-hint">Higher grades have greater strength</div>
                    </div>
                </div>
                
                <div class="connection-box">
                    <h3>Connection Information</h3>
                    <div class="flex flex-col md:flex-row gap-4">
                        <div class="form-group w-full">
                            <label for="connection-type">What are you fixing this member to?</label>
                            <select id="connection-type" onchange="updateConnectionOptions()">
                                <option value="column">Column</option>
                                <option value="beam">Beam</option>
                                <option value="wall">Wall</option>
                                <option value="foundation">Foundation</option>
                                <option value="other">Other</option>
                            </select>
                        </div>
                        
                        <div class="form-group w-full">
                            <label for="connection-method">Connection Method</label>
                            <select id="connection-method">
                                <option value="bolted">Bolted</option>
                                <option value="welded">Welded</option>
                                <option value="both">Both Bolted & Welded</option>
                            </select>
                        </div>
                    </div>
                    
                    <div id="connection-options"></div>
                    
                    <div class="mt-4 flex items-center gap-2">
                        <button id="advanced-connection-btn" class="btn btn-secondary" type="button" onclick="toggleAdvancedConnections()">
                            <span class="btn-icon">⚙️</span> Advanced Connection Options
                        </button>
                        <div class="tooltip" data-tooltip="Configure connection parameters like bolt diameter, edge distances, and weld sizes">ℹ️</div>
                    </div>
                    
                    <div id="advanced-connection-options" class="mt-4 p-4 rounded border bg-light hidden">
                        <h4 class="mb-4">Advanced Connection Parameters</h4>
                        
                        <div class="flex flex-col md:flex-row gap-4">
                            <div class="form-group w-full">
                                <label for="bolt-diameter">Bolt Diameter</label>
                                <select id="bolt-diameter">
                                    <option value="M16">M16</option>
                                    <option value="M20" selected>M20</option>
                                    <option value="M24">M24</option>
                                    <option value="M30">M30</option>
                                </select>
                            </div>
                            
                            <div class="form-group w-full">
                                <label for="bolt-grade">Bolt Grade</label>
                                <select id="bolt-grade">
                                    <option value="4.6">4.6</option>
                                    <option value="8.8" selected>8.8</option>
                                    <option value="10.9">10.9</option>
                                </select>
                            </div>
                            
                            <div class="form-group w-full">
                                <label for="num-bolts">Number of Bolts</label>
                                <input type="number" id="num-bolts" value="4" min="2" max="12" step="2">
                            </div>
                        </div>
                        
                        <div class="form-group">
                            <label for="edge-distance">Edge Distance (mm)</label>
                            <input type="number" id="edge-distance" value="40" min="20">
                        </div>
                        
                        <div id="weld-options" class="flex flex-col md:flex-row gap-4">
                            <div class="form-group w-full">
                                <label for="weld-size">Weld Size (mm)</label>
                                <input type="number" id="weld-size" value="6" min="3" max="16" step="1">
                            </div>
                            
                            <div class="form-group w-full">
                                <label for="weld-type">Weld Type</label>
                                <select id="weld-type">
                                    <option value="fillet">Fillet</option>
                                    <option value="butt">Butt</option>
                                </select>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Frame Design Form -->
            <div id="frame-design-form" class="hidden">
                <h2>Frame Design</h2>
                
                <div class="file-upload" id="drop-area" onclick="document.getElementById('file-input').click()">
                    <input type="file" id="file-input" accept="image/*,.pdf,.dxf,.dwg" onchange="handleFileUpload(event)">
                    <div class="upload-icon">📤</div>
                    <h3>Upload Frame Sketch or CAD Drawing</h3>
                    <p>Click or drag to upload (JPG, PNG, PDF, DXF, DWG)</p>
                </div>
                
                <div id="preview-container" class="hidden">
                    <img id="preview-image" style="max-width: 100%; margin-bottom: 20px; border-radius: 8px;">
                    
                    <div class="flex flex-col md:flex-row gap-4">
                        <div class="form-group w-full">
                            <label for="frame-width">Frame Width (mm)</label>
                            <input type="number" id="frame-width" value="6000" min="1000">
                        </div>
                        
                        <div class="form-group w-full">
                            <label for="frame-height">Frame Height (mm)</label>
                            <input type="number" id="frame-height" value="3000" min="1000">
                        </div>
                    </div>
                    
                    <div class="connection-box">
                        <h3>Frame Connection Information</h3>
                        <div class="flex flex-col md:flex-row gap-4">
                            <div class="form-group w-full">
                                <label for="frame-connection-type">What are you fixing this frame to?</label>
                                <select id="frame-connection-type">
                                    <option value="foundation">Foundation</option>
                                    <option value="existing-structure">Existing Structure</option>
                                    <option value="wall">Wall</option>
                                    <option value="other">Other</option>
                                </select>
                            </div>
                            
                            <div class="form-group w-full">
                                <label for="frame-connection-method">Primary Connection Method</label>
                                <select id="frame-connection-method">
                                    <option value="bolted">Bolted</option>
                                    <option value="welded">Welded</option>
                                    <option value="both">Both Bolted & Welded</option>
                                </select>
                            </div>
                        </div>
                        
                        <div class="mt-4">
                            <details>
                                <summary class="cursor-pointer font-semibold">Material & Member Settings</summary>
                                <div class="mt-4 p-4 rounded border bg-light">
                                    <div class="form-group">
                                        <label for="frame-steel-grade">Steel Grade</label>
                                        <select id="frame-steel-grade">
                                            <option value="300">Grade 300</option>
                                            <option value="350">Grade 350</option>
                                            <option value="400">Grade 400</option>
                                        </select>
                                    </div>
                                    
                                    <div class="form-group">
                                        <label>Default Member Types</label>
                                        <div class="flex flex-col md:flex-row gap-4">
                                            <div class="form-group w-full">
                                                <label for="default-column">Columns</label>
                                                <select id="default-column">
                                                    <option value="uc">Universal Column (UC)</option>
                                                    <option value="shs">Square Hollow Section (SHS)</option>
                                                </select>
                                            </div>
                                            
                                            <div class="form-group w-full">
                                                <label for="default-beam">Beams</label>
                                                <select id="default-beam">
                                                    <option value="ub">Universal Beam (UB)</option>
                                                    <option value="rhs">Rectangular Hollow Section (RHS)</option>
                                                </select>
                                            </div>
                                            
                                            <div class="form-group w-full">
                                                <label for="default-brace">Braces</label>
                                                <select id="default-brace">
                                                    <option value="angle">Equal Angle (EA)</option>
                                                    <option value="rhs">Rectangular Hollow Section (RHS)</option>
                                                </select>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </details>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Step 3: Loading Information -->
        <div class="card hidden" id="step3" role="tabpanel" aria-labelledby="step3-indicator">
            <h2>Loading Information</h2>
            
            <div class="flex items-center mb-4">
                <label class="mr-2 font-semibold">Loading Type:</label>
                <div class="flex gap-2">
                    <label class="flex items-center gap-1 cursor-pointer">
                        <input type="radio" name="loading-type" value="simple" checked onchange="toggleLoadingType('simple')">
                        <span>Simple</span>
                    </label>
                    <label class="flex items-center gap-1 cursor-pointer">
                        <input type="radio" name="loading-type" value="advanced" onchange="toggleLoadingType('advanced')">
                        <span>Advanced</span>
                    </label>
                </div>
                <div class="tooltip ml-2" data-tooltip="Simple: Enter direct loads. Advanced: Configure loads by category and location">ℹ️</div>
            </div>
            
            <!-- Simple Loading Form -->
            <div id="simple-loading-form">
                <div class="flex flex-col md:flex-row gap-4">
                    <div class="form-group w-full">
                        <label for="dead-load">
                            Dead Load (kN)
                            <span class="tooltip" data-tooltip="Permanent loads including self-weight">ℹ️</span>
                        </label>
                        <input type="number" id="dead-load" value="5" min="0" step="0.1" required>
                        <div class="input-error">Please enter a valid load (minimum 0)</div>
                    </div>
                    
                    <div class="form-group w-full">
                        <label for="live-load">
                            Live Load (kN)
                            <span class="tooltip" data-tooltip="Temporary loads such as occupancy, furniture, etc.">ℹ️</span>
                        </label>
                        <input type="number" id="live-load" value="10" min="0" step="0.1" required>
                        <div class="input-error">Please enter a valid load (minimum 0)</div>
                    </div>
                </div>
                
                <div class="flex flex-col md:flex-row gap-4">
                    <div class="form-group w-full">
                        <label for="wind-load">
                            Wind Load (kN)
                            <span class="tooltip" data-tooltip="Horizontal forces due to wind pressure">ℹ️</span>
                        </label>
                        <input type="number" id="wind-load" value="2" min="0" step="0.1" required>
                        <div class="input-error">Please enter a valid load (minimum 0)</div>
                    </div>
                    
                    <div class="form-group w-full">
                        <label for="snow-load">
                            Snow Load (kN)
                            <span class="tooltip" data-tooltip="Load from snow accumulation (if applicable)">ℹ️</span>
                        </label>
                        <input type="number" id="snow-load" value="0" min="0" step="0.1" required>
                        <div class="input-error">Please enter a valid load (minimum 0)</div>
                    </div>
                </div>
                
                <div class="connection-box mt-4">
                    <h3>Load Application</h3>
                    
                    <div class="form-group">
                        <label for="load-type">Load Distribution</label>
                        <select id="load-type">
                            <option value="point">Point Load</option>
                            <option value="uniform" selected>Uniform Load</option>
                            <option value="triangular">Triangular Load</option>
                        </select>
                    </div>
                    
                    <div id="point-load-options" class="hidden">
                        <div class="form-group">
                            <label for="point-load-position">Load Position (% of span from left)</label>
                            <input type="range" id="point-load-position" min="0" max="100" value="50" step="5" oninput="updatePointLoadDisplay()">
                            <div id="point-load-display" class="input-hint">Position: 50% of span</div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Advanced Loading Form -->
            <div id="advanced-loading-form" class="hidden">
                <div class="flex flex-col gap-4">
                    <div class="connection-box">
                        <h3>Self-Weight & Permanent Loads</h3>
                        
                        <div class="form-group">
                            <label for="include-self-weight">
                                <input type="checkbox" id="include-self-weight" checked>
                                Include member self-weight in calculations
                            </label>
                        </div>
                        
                        <div class="flex flex-col md:flex-row gap-4">
                            <div class="form-group w-full">
                                <label for="permanent-distributed-load">Distributed Dead Load (kN/m)</label>
                                <input type="number" id="permanent-distributed-load" value="1.2" min="0" step="0.1">
                            </div>
                            
                            <div class="form-group w-full">
                                <label for="permanent-point-load">Point Dead Load (kN)</label>
                                <input type="number" id="permanent-point-load" value="0" min="0" step="0.1">
                            </div>
                            
                            <div class="form-group w-full">
                                <label for="permanent-point-position">Point Load Position (m)</label>
                                <input type="number" id="permanent-point-position" value="0" min="0" step="0.1">
                            </div>
                        </div>
                    </div>
                    
                    <div class="connection-box">
                        <h3>Live Loads</h3>
                        
                        <div class="form-group">
                            <label for="live-load-type">Live Load Type</label>
                            <select id="live-load-type">
                                <option value="office">Office (2.5 kPa)</option>
                                <option value="residential">Residential (1.5 kPa)</option>
                                <option value="storage">Storage (5.0 kPa)</option>
                                <option value="industrial">Industrial (5.0 kPa)</option>
                                <option value="custom">Custom</option>
                            </select>
                        </div>
                        
                        <div id="custom-live-load" class="hidden">
                            <div class="flex flex-col md:flex-row gap-4">
                                <div class="form-group w-full">
                                    <label for="custom-live-load-intensity">Custom Live Load (kPa)</label>
                                    <input type="number" id="custom-live-load-intensity" value="2.5" min="0" step="0.1">
                                </div>
                                
                                <div class="form-group w-full">
                                    <label for="custom-live-load-factor">Load Factor</label>
                                    <input type="number" id="custom-live-load-factor" value="1.5" min="0.5" max="2.0" step="0.1">
                                </div>
                            </div>
                        </div>
                        
                        <div class="form-group">
                            <label for="live-load-patterns">Live Load Patterns to Consider</label>
                            <select id="live-load-patterns" multiple size="3">
                                <option value="full-span" selected>Full span loaded</option>
                                <option value="left-half">Left half loaded</option>
                                <option value="right-half">Right half loaded</option>
                                <option value="checkerboard">Checkerboard pattern</option>
                            </select>
                            <div class="input-hint">Hold Ctrl/Cmd to select multiple options</div>
                        </div>
                    </div>
                    
                    <div class="connection-box">
                        <h3>Wind & Environmental Loads</h3>
                        
                        <div class="flex flex-col md:flex-row gap-4">
                            <div class="form-group w-full">
                                <label for="wind-region">Wind Region (AS/NZS 1170.2)</label>
                                <select id="wind-region">
                                    <option value="A">Region A</option>
                                    <option value="B">Region B</option>
                                    <option value="C">Region C</option>
                                    <option value="D">Region D</option>
                                </select>
                            </div>
                            
                            <div class="form-group w-full">
                                <label for="terrain-category">Terrain Category</label>
                                <select id="terrain-category">
                                    <option value="1">Category 1 (Open sea)</option>
                                    <option value="2" selected>Category 2 (Open terrain)</option>
                                    <option value="3">Category 3 (Suburban)</option>
                                    <option value="4">Category 4 (Urban)</option>
                                </select>
                            </div>
                        </div>
                        
                        <div class="form-group">
                            <label for="building-importance">Building Importance Level</label>
                            <select id="building-importance">
                                <option value="1">Level 1 (Low consequence)</option>
                                <option value="2" selected>Level 2 (Normal)</option>
                                <option value="3">Level 3 (High importance)</option>
                                <option value="4">Level 4 (Essential facility)</option>
                            </select>
                        </div>
                        
                        <div class="form-group">
                            <label for="snow-load-region">Snow Load Region</label>
                            <select id="snow-load-region">
                                <option value="none" selected>No snow consideration</option>
                                <option value="alpine">Alpine region</option>
                                <option value="sub-alpine">Sub-alpine region</option>
                                <option value="custom">Custom snow load</option>
                            </select>
                        </div>
                        
                        <div id="custom-snow-load" class="hidden">
                            <div class="form-group">
                                <label for="custom-snow-load-value">Custom Snow Load (kPa)</label>
                                <input type="number" id="custom-snow-load-value" value="0.5" min="0" step="0.1">
                            </div>
                        </div>
                    </div>
                    
                    <div class="connection-box">
                        <h3>Load Combinations</h3>
                        
                        <div class="form-group">
                            <label for="load-combination-standard">Load Combination Standard</label>
                            <select id="load-combination-standard">
                                <option value="as1170" selected>AS/NZS 1170.0</option>
                                <option value="custom">Custom combinations</option>
                            </select>
                        </div>
                        
                        <div id="standard-combinations" class="mt-4">
                            <div class="bg-light p-4 rounded border">
                                <h4 class="mb-2">Standard Combinations per AS/NZS 1170.0:</h4>
                                <ul class="list-disc ml-6">
                                    <li>1.35G</li>
                                    <li>1.2G + 1.5Q</li>
                                    <li>1.2G + 1.5Q + 0.5S</li>
                                    <li>1.2G + 0.4Q + W</li>
                                    <li>0.9G + W</li>
                                </ul>
                                <div class="mt-2">
                                    <label class="flex items-center gap-2">
                                        <input type="checkbox" id="use-serviceability" checked>
                                        Include serviceability limit state checks
                                    </label>
                                </div>
                            </div>
                        </div>
                        
                        <div id="custom-combinations" class="hidden mt-4">
                            <button class="btn btn-secondary" type="button" onclick="addLoadCombination()">
                                <span class="btn-icon">+</span> Add Load Combination
                            </button>
                            
                            <div id="load-combinations" class="mt-4">
                                <div class="load-combination p-4 rounded border bg-light mb-2">
                                    <div class="flex justify-between mb-2">
                                        <h4>Combination 1</h4>
                                        <button type="button" class="remove-btn" onclick="removeLoadCombination(this)">✕</button>
                                    </div>
                                    
                                    <div class="flex flex-col md:flex-row gap-4">
                                        <div class="form-group w-full">
                                            <label for="combo1-g-factor">Dead Load Factor</label>
                                            <input type="number" id="combo1-g-factor" value="1.2" step="0.1">
                                        </div>
                                        
                                        <div class="form-group w-full">
                                            <label for="combo1-q-factor">Live Load Factor</label>
                                            <input type="number" id="combo1-q-factor" value="1.5" step="0.1">
                                        </div>
                                        
                                        <div class="form-group w-full">
                                            <label for="combo1-w-factor">Wind Load Factor</label>
                                            <input type="number" id="combo1-w-factor" value="0" step="0.1">
                                        </div>
                                        
                                        <div class="form-group w-full">
                                            <label for="combo1-s-factor">Snow Load Factor</label>
                                            <input type="number" id="combo1-s-factor" value="0" step="0.1">
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Step 4: Results -->
        <div class="card hidden" id="step4" role="tabpanel" aria-labelledby="step4-indicator">
            <h2>Design Results</h2>
            
            <div class="flex flex-wrap gap-4 mb-4">
                <button class="btn" type="button" id="download-report-btn" onclick="downloadPDF()">
                    <span class="btn-icon">📄</span> Download Report
                </button>
                
                <button class="btn btn-secondary" type="button" id="download-cad-btn" onclick="downloadCAD()">
                    <span class="btn-icon">📐</span> Download CAD
                </button>
                
                <button class="btn btn-secondary" type="button" id="share-btn" onclick="shareDesign()">
                    <span class="btn-icon">🔗</span> Share Design
                </button>
            </div>
            
            <div class="flex mb-4">
                <div class="flex-1">
                    <select id="result-view-selector" onchange="switchResultView()">
                        <option value="summary">Summary View</option>
                        <option value="detailed">Detailed Analysis</option>
                        <option value="visual">3D Visualization</option>
                        <option value="connections">Connection Details</option>
                    </select>
                </div>
            </div>
            
            <div id="results">
                <!-- Results will be populated by JavaScript -->
                <div id="result-summary" class="results-container fade-in">
                    <div class="result-section">
                        <h3>Member Analysis</h3>
                        <table class="result-table">
                            <tr>
                                <th>Capacity</th>
                                <th>Design Value</th>
                                <th>Required</th>
                                <th>Utilization</th>
                            </tr>
                            <tr>
                                <td>Moment Capacity</td>
                                <td>0.00 kNm</td>
                                <td>0.00 kNm</td>
                                <td><span class="status status-ok">0.0%</span></td>
                            </tr>
                            <tr>
                                <td>Shear Capacity</td>
                                <td>0.00 kN</td>
                                <td>0.00 kN</td>
                                <td><span class="status status-ok">0.0%</span></td>
                            </tr>
                            <tr>
                                <td>Compression Capacity</td>
                                <td>0.00 kN</td>
                                <td>0.00 kN</td>
                                <td><span class="status status-ok">0.0%</span></td>
                            </tr>
                            <tr>
                                <td>Deflection</td>
                                <td>0.00 mm</td>
                                <td>0.00 mm</td>
                                <td><span class="status status-ok">0.0%</span></td>
                            </tr>
                        </table>
                        
                        <h3>Section Properties</h3>
                        <table class="result-table">
                            <tr>
                                <th>Property</th>
                                <th>Value</th>
                            </tr>
                            <tr>
                                <td>Section</td>
                                <td>-</td>
                            </tr>
                            <tr>
                                <td>Weight</td>
                                <td>0.0 kg/m</td>
                            </tr>
                            <tr>
                                <td>Steel Grade</td>
                                <td>-</td>
                            </tr>
                            <tr>
                                <td>Dimensions</td>
                                <td>-</td>
                            </tr>
                        </table>
                    </div>
                    
                    <div class="result-section">
                        <h3>Connection Design</h3>
                        <table class="result-table">
                            <tr>
                                <th>Property</th>
                                <th>Value</th>
                            </tr>
                            <tr>
                                <td>Connection Type</td>
                                <td>-</td>
                            </tr>
                            <tr>
                                <td>Connection Method</td>
                                <td>-</td>
                            </tr>
                            <tr>
                                <td>Bolts</td>
                                <td>-</td>
                            </tr>
                            <tr>
                                <td>Plate Thickness</td>
                                <td>0 mm</td>
                            </tr>
                            <tr>
                                <td>Plate Dimensions</td>
                                <td>-</td>
                            </tr>
                            <tr>
                                <td>Weld Size</td>
                                <td>-</td>
                            </tr>
                            <tr>
                                <td>Shear Capacity</td>
                                <td>0.00 kN</td>
                            </tr>
                            <tr>
                                <td>Connection Status</td>
                                <td><span class="status status-ok">ADEQUATE</span></td>
                            </tr>
                        </table>
                        
                        <h3>Shop Drawing</h3>
                        <div class="drawing-container">
                            <canvas id="shop-drawing" width="600" height="400"></canvas>
                        </div>
                        
                        <div class="fabrication-instructions mt-4">
                            <h4>Fabrication Instructions</h4>
                            <pre>Design results will appear here after calculation.</pre>
                        </div>
                    </div>
                </div>
                
                <div id="result-detailed" class="hidden">
                    <h3>Detailed Member Analysis</h3>
                    <div class="drawing-container">
                        <canvas id="detailed-analysis" width="800" height="400"></canvas>
                    </div>
                    
                    <div class="mt-4 p-4 rounded border bg-light">
                        <h4 class="mb-2">Analysis Notes</h4>
                        <ul id="analysis-notes">
                            <li>Analysis results will appear after calculation.</li>
                        </ul>
                    </div>
                    
                    <h3 class="mt-4">Load Combinations</h3>
                    <table class="result-table">
                        <thead>
                            <tr>
                                <th>Combination</th>
                                <th>Description</th>
                                <th>Moment (kNm)</th>
                                <th>Shear (kN)</th>
                                <th>Axial (kN)</th>
                                <th>Utilization</th>
                            </tr>
                        </thead>
                        <tbody id="load-combinations-results">
                            <tr>
                                <td colspan="6">Load combination results will appear after calculation.</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
                
                <div id="result-visual" class="hidden">
                    <h3>3D Visualization</h3>
                    <div class="drawing-container" style="height: 500px;">
                        <div id="threed-container" style="width: 100%; height: 100%;"></div>
                    </div>
                    
                    <div class="flex mt-4 gap-4 flex-wrap">
                        <button class="btn btn-secondary" type="button" onclick="rotate3DModel()">
                            <span class="btn-icon">🔄</span> Rotate View
                        </button>
                        
                        <button class="btn btn-secondary" type="button" onclick="toggle3DDeformation()">
                            <span class="btn-icon">📊</span> Show Deformation
                        </button>
                        
                        <button class="btn btn-secondary" type="button" onclick="toggle3DStressContours()">
                            <span class="btn-icon">🌈</span> Stress Contours
                        </button>
                        
                        <div class="form-group ml-auto">
                            <label for="deformation-scale">Deformation Scale:</label>
                            <input type="range" id="deformation-scale" min="1" max="100" value="20" oninput="update3DDeformationScale()">
                        </div>
                    </div>
                </div>
                
                <div id="result-connections" class="hidden">
                    <h3>Connection Details</h3>
                    
                    <div class="connection-selector mb-4">
                        <label for="connection-view">Select Connection:</label>
                        <select id="connection-view" onchange="switchConnectionView()">
                            <option value="main">Main Connection</option>
                            <option value="secondary">Secondary Connections</option>
                        </select>
                    </div>
                    
                    <div class="drawing-container">
                        <canvas id="connection-drawing" width="800" height="600"></canvas>
                    </div>
                    
                    <div class="mt-4">
                        <h4>Connection Specification</h4>
                        <table class="result-table">
                            <tbody id="connection-specs">
                                <tr>
                                    <td>Bolt Specification</td>
                                    <td>-</td>
                                </tr>
                                <tr>
                                    <td>Plate Specification</td>
                                    <td>-</td>
                                </tr>
                                <tr>
                                    <td>Weld Specification</td>
                                    <td>-</td>
                                </tr>
                                <tr>
                                    <td>Connection Capacity</td>
                                    <td>-</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                    
                    <div class="mt-4">
                        <h4>Material Requirements</h4>
                        <table class="result-table">
                            <thead>
                                <tr>
                                    <th>Item</th>
                                    <th>Specification</th>
                                    <th>Quantity</th>
                                    <th>Weight</th>
                                </tr>
                            </thead>
                            <tbody id="material-requirements">
                                <tr>
                                    <td colspan="4">Material requirements will appear after calculation.</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Navigation Buttons -->
        <div class="button-container">
            <button class="btn btn-secondary" id="prev-button" disabled>
                <span class="btn-icon">◀</span> Previous
            </button>
            <button class="btn" id="next-button" disabled>
                Next <span class="btn-icon">▶</span>
            </button>
        </div>
        
        <!-- Notification component -->
        <div class="notification" id="notification">
            <div class="notification-icon" id="notification-icon">✓</div>
            <div class="notification-content" id="notification-message">Notification message</div>
            <button class="notification-close" onclick="hideNotification()">×</button>
        </div>
    </div>
    
    <!-- JavaScript for the app -->
    <script>
        // Global variables
        let designType = null;
        let currentStep = 1;
        let sectionData = null;
        let connectionData = null;
        let loadingData = null;
        let uploadedImage = null;
        let isDarkMode = false;
        let threeDScene = null;
        
        // Section database
        const sectionDatabase = {
            ub: [
                { size: '610UB125', mass: 125, depth: 612, width: 229, tf: 19.6, tw: 11.9, 
                  Ix: 986000000, Iy: 45600000, Zx: 3560000, Zy: 398000 },
                { size: '610UB113', mass: 113, depth: 607, width: 228, tf: 17.3, tw: 11.2, 
                  Ix: 875000000, Iy: 41300000, Zx: 3180000, Zy: 362000 },
                { size: '530UB92', mass: 92.4, depth: 533, width: 209, tf: 15.6, tw: 10.2, 
                  Ix: 554000000, Iy: 30400000, Zx: 2280000, Zy: 291000 },
                { size: '460UB82', mass: 82.1, depth: 460, width: 191, tf: 16.0, tw: 9.9, 
                  Ix: 370000000, Iy: 22300000, Zx: 1750000, Zy: 233000 },
                { size: '460UB74', mass: 74.6, depth: 457, width: 190, tf: 14.5, tw: 9.1, 
                  Ix: 333000000, Iy: 20100000, Zx: 1580000, Zy: 212000 },
                { size: '410UB60', mass: 59.7, depth: 406, width: 178, tf: 12.8, tw: 7.8, 
                  Ix: 216000000, Iy: 13600000, Zx: 1160000, Zy: 153000 },
                { size: '360UB57', mass: 56.7, depth: 358, width: 172, tf: 13.8, tw: 8.1, 
                  Ix: 161000000, Iy: 11700000, Zx: 992000, Zy: 136000 },
                { size: '310UB46', mass: 46.2, depth: 308, width: 166, tf: 11.8, tw: 6.7,
                  Ix: 94100000, Iy: 8650000, Zx: 674000, Zy: 104000 },
                { size: '250UB37', mass: 37.3, depth: 256, width: 146, tf: 10.9, tw: 6.4,
                  Ix: 49900000, Iy: 4360000, Zx: 427000, Zy: 59700 },
                { size: '200UB29', mass: 29.8, depth: 207, width: 134, tf: 9.6, tw: 6.3,
                  Ix: 26700000, Iy: 2690000, Zx: 279000, Zy: 40100 }
            ],
            uc: [
                { size: '310UC158', mass: 158, depth: 327, width: 311, tf: 25.0, tw: 15.7, 
                  Ix: 476000000, Iy: 149000000, Zx: 3250000, Zy: 958000 },
                { size: '310UC137', mass: 137, depth: 320, width: 309, tf: 21.7, tw: 13.8, 
                  Ix: 397000000, Iy: 127000000, Zx: 2760000, Zy: 823000 },
                { size: '250UC89', mass: 89.5, depth: 260, width: 256, tf: 17.3, tw: 10.5, 
                  Ix: 142000000, Iy: 44900000, Zx: 1230000, Zy: 351000 },
                { size: '200UC60', mass: 59.5, depth: 210, width: 205, tf: 14.2, tw: 9.3, 
                  Ix: 60800000, Iy: 18700000, Zx: 666000, Zy: 182000 },
                { size: '200UC52', mass: 52.2, depth: 206, width: 204, tf: 12.5, tw: 8.0, 
                  Ix: 52800000, Iy: 16400000, Zx: 578000, Zy: 161000 },
                { size: '150UC37', mass: 37.2, depth: 162, width: 154, tf: 11.5, tw: 8.0, 
                  Ix: 22200000, Iy: 6060000, Zx: 327000, Zy: 78700 },
                { size: '150UC30', mass: 30.0, depth: 158, width: 153, tf: 9.4, tw: 6.6,
                  Ix: 17400000, Iy: 4860000, Zx: 261000, Zy: 63500 },
                { size: '100UC15', mass: 14.8, depth: 100, width: 100, tf: 6.0, tw: 5.0,
                  Ix: 3830000, Iy: 1250000, Zx: 86800, Zy: 25000 }
            ],
            pfc: [
                { size: '380PFC', mass: 55.2, depth: 380, width: 100, tf: 17.5, tw: 10.0, 
                  Ix: 332000000, Iy: 8180000, Zx: 1950000, Zy: 124000 },
                { size: '300PFC', mass: 40.1, depth: 300, width: 90, tf: 15.5, tw: 9.0, 
                  Ix: 145000000, Iy: 4770000, Zx: 1070000, Zy: 79400 },
                { size: '250PFC', mass: 35.5, depth: 250, width: 90, tf: 15.0, tw: 8.0, 
                  Ix: 88700000, Iy: 4250000, Zx: 780000, Zy: 71700 },
                { size: '230PFC', mass: 32.1, depth: 230, width: 75, tf: 13.5, tw: 7.5, 
                  Ix: 64400000, Iy: 2210000, Zx: 612000, Zy: 44200 },
                { size: '200PFC', mass: 29.8, depth: 200, width: 75, tf: 12.5, tw: 7.0, 
                  Ix: 44500000, Iy: 1960000, Zx: 497000, Zy: 40100 },
                { size: '180PFC', mass: 26.0, depth: 180, width: 75, tf: 11.0, tw: 6.0,
                  Ix: 33200000, Iy: 1740000, Zx: 413000, Zy: 35900 },
                { size: '150PFC', mass: 22.1, depth: 150, width: 75, tf: 9.5, tw: 5.0,
                  Ix: 19100000, Iy: 1380000, Zx: 288000, Zy: 30000 }
            ],
            rhs: [
                { size: '400x300x16RHS', mass: 154, depth: 400, width: 300, thickness: 16, 
                  Ix: 397000000, Iy: 241000000, Zx: 2380000, Zy: 1880000 },
                { size: '350x250x12.5RHS', mass: 102, depth: 350, width: 250, thickness: 12.5, 
                  Ix: 211000000, Iy: 125000000, Zx: 1400000, Zy: 1120000 },
                { size: '300x200x10RHS', mass: 73.6, depth: 300, width: 200, thickness: 10, 
                  Ix: 114000000, Iy: 60400000, Zx: 845000, Zy: 671000 },
                { size: '250x150x9RHS', mass: 51.8, depth: 250, width: 150, thickness: 9, 
                  Ix: 55000000, Iy: 23400000, Zx: 495000, Zy: 356000 },
                { size: '200x100x6RHS', mass: 26.7, depth: 200, width: 100, thickness: 6, 
                  Ix: 20400000, Iy: 6130000, Zx: 232000, Zy: 141000 },
                { size: '150x100x5RHS', mass: 18.6, depth: 150, width: 100, thickness: 5,
                  Ix: 7530000, Iy: 3820000, Zx: 115000, Zy: 90200 },
                { size: '125x75x4RHS', mass: 11.7, depth: 125, width: 75, thickness: 4,
                  Ix: 3210000, Iy: 1320000, Zx: 58700, Zy: 40600 }
            ],
            shs: [
                { size: '350x350x16SHS', mass: 172, width: 350, thickness: 16, 
                  Ix: 348000000, Iy: 348000000, Zx: 2330000, Zy: 2330000 },
                { size: '300x300x12.5SHS', mass: 112, width: 300, thickness: 12.5, 
                  Ix: 176000000, Iy: 176000000, Zx: 1380000, Zy: 1380000 },
                { size: '250x250x12.5SHS', mass: 92, width: 250, thickness: 12.5, 
                  Ix: 100000000, Iy: 100000000, Zx: 943000, Zy: 943000 },
                { size: '200x200x9SHS', mass: 52.4, width: 200, thickness: 9, 
                  Ix: 42700000, Iy: 42700000, Zx: 499000, Zy: 499000 },
                { size: '150x150x9SHS', mass: 38.3, width: 150, thickness: 9, 
                  Ix: 17200000, Iy: 17200000, Zx: 274000, Zy: 274000 },
                { size: '125x125x5SHS', mass: 18.4, width: 125, thickness: 5,
                  Ix: 5310000, Iy: 5310000, Zx: 99900, Zy: 99900 },
                { size: '100x100x5SHS', mass: 14.4, width: 100, thickness: 5,
                  Ix: 2690000, Iy: 2690000, Zx: 64200, Zy: 64200 },
                { size: '75x75x4SHS', mass: 8.55, width: 75, thickness: 4,
                  Ix: 912000, Iy: 912000, Zx: 29300, Zy: 29300 }
            ],
            angle: [
                { size: '150x150x18EA', mass: 39.5, leg: 150, thickness: 18,
                  Ix: 12300000, Iy: 12300000, Zx: 114000, Zy: 114000 },
                { size: '125x125x12EA', mass: 22.2, leg: 125, thickness: 12,
                  Ix: 4530000, Iy: 4530000, Zx: 51200, Zy: 51200 },
                { size: '100x100x12EA', mass: 17.6, leg: 100, thickness: 12,
                  Ix: 2290000, Iy: 2290000, Zx: 32300, Zy: 32300 },
                { size: '75x75x10EA', mass: 10.9, leg: 75, thickness: 10,
                  Ix: 787000, Iy: 787000, Zx: 15000, Zy: 15000 },
                { size: '65x65x5EA', mass: 4.9, leg: 65, thickness: 5,
                  Ix: 302000, Iy: 302000, Zx: 6580, Zy: 6580 }
            ],
            uangle: [
                { size: '150x100x12UA', mass: 22.1, legH: 150, legV: 100, thickness: 12,
                  Ix: 5980000, Iy: 1950000, Zx: 57200, Zy: 28400 },
                { size: '125x75x10UA', mass: 14.6, legH: 125, legV: 75, thickness: 10,
                  Ix: 2640000, Iy: 660000, Zx: 31200, Zy: 12700 },
                { size: '100x75x8UA', mass: 10.3, legH: 100, legV: 75, thickness: 8,
                  Ix: 1220000, Iy: 526000, Zx: 17900, Zy: 10500 },
                { size: '75x50x5UA', mass: 4.64, legH: 75, legV: 50, thickness: 5,
                  Ix: 341000, Iy: 104000, Zx: 6730, Zy: 3130 }
            ],
            chs: [
                { size: '406x12.7CHS', mass: 123, diameter: 406, thickness: 12.7,
                  Ix: 230000000, Iy: 230000000, Zx: 1320000, Zy: 1320000 },
                { size: '355x9.5CHS', mass: 80.7, diameter: 355, thickness: 9.5,
                  Ix: 115000000, Iy: 115000000, Zx: 756000, Zy: 756000 },
                { size: '273x9.3CHS', mass: 59.9, diameter: 273, thickness: 9.3,
                  Ix: 45900000, Iy: 45900000, Zx: 391000, Zy: 391000 },
                { size: '219x8.2CHS', mass: 42.5, diameter: 219, thickness: 8.2,
                  Ix: 22300000, Iy: 22300000, Zx: 237000, Zy: 237000 },
                { size: '168x6.4CHS', mass: 25.4, diameter: 168, thickness: 6.4,
                  Ix: a890000, Iy: 8890000, Zx: 125000, Zy: 125000 },
                { size: '114x6.0CHS', mass: 16.0, diameter: 114, thickness: 6.0,
                  Ix: 2360000, Iy: 2360000, Zx: 48900, Zy: 48900 },
                { size: '88.9x5.0CHS', mass: 10.3, diameter: 88.9, thickness: 5.0,
                  Ix: a890000, Iy: 889000, Zx: 23800, Zy: 23800 }
            ]
        };
        
        // Engineering constants
        const CONSTANTS = {
            // Capacity factors (AS 4100-2020)
            PHI: {
                MOMENT: 0.9,
                SHEAR: 0.9,
                TENSION: 0.9,
                COMPRESSION: 0.9,
                BEARING: 0.9,
                BOLT_SHEAR: 0.8,
                BOLT_TENSION: 0.8,
                WELD: 0.8
            },
            
            // Steel grades
            STEEL_GRADE: {
                '300': {
                    fy: 300,
                    fu: 440,
                    E: 200000,
                    G: 80000,
                    v: 0.3
                },
                '350': {
                    fy: 350,
                    fu: 480,
                    E: 200000,
                    G: 80000,
                    v: 0.3
                },
                '400': {
                    fy: 400,
                    fu: 520,
                    E: 200000,
                    G: 80000,
                    v: 0.3
                },
                '450': {
                    fy: 450, 
                    fu: 550,
                    E: 200000,
                    G: 80000,
                    v: 0.3
                }
            },
            
            // Bolt grades
            BOLT_GRADE: {
                '4.6': {
                    fyb: 240,
                    fub: 400
                },
                '8.8': {
                    fyb: 640,
                    fub: 800
                },
                '10.9': {
                    fyb: 900,
                    fub: 1000
                }
            },
            
            // Load combination factors (AS/NZS 1170.0)
            LOAD_FACTORS: {
                DEAD: 1.35,
                DEAD_WITH_LIVE: 1.2,
                LIVE: 1.5,
                WIND: 1.0,
                SNOW: 0.5
            }
        };
        
        // Set up event listeners when the DOM is loaded
        document.addEventListener('DOMContentLoaded', function() {
            initializeApp();
            setupEventListeners();
            setupDragAndDrop();
            showNotification('Application loaded successfully', 'success');
        });
        
        // Initialize the app
        function initializeApp() {
            // Initialize the section sizes dropdown
            updateSectionSizes();
            
            // Show the first step
            updateStepDisplay();
            
            // Set up event handlers for keyboard navigation
            setupKeyboardNavigation();
            
            // Check for saved preferences (dark mode, etc.)
            checkSavedPreferences();
        }
        
        // Set up all event listeners
        function setupEventListeners() {
            // Navigation buttons
            document.getElementById('prev-button').addEventListener('click', previousStep);
            document.getElementById('next-button').addEventListener('click', nextStep);
            
            // Step indicators for direct navigation
            document.querySelectorAll('.step-circle').forEach(function(circle) {
                circle.addEventListener('click', function() {
                    const step = parseInt(this.textContent);
                    if (step < currentStep) {
                        goToStep(step);
                    }
                });
            });
            
            // Dynamic form elements
            document.getElementById('load-type').addEventListener('change', function() {
                const loadType = this.value;
                document.getElementById('point-load-options').classList.toggle('